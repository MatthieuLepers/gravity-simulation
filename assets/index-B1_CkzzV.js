var wn=Object.defineProperty;var mn=(n,t,s)=>t in n?wn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var N=(n,t,s)=>mn(n,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))d(f);new MutationObserver(f=>{for(const w of f)if(w.type==="childList")for(const b of w.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&d(b)}).observe(document,{childList:!0,subtree:!0});function s(f){const w={};return f.integrity&&(w.integrity=f.integrity),f.referrerPolicy&&(w.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?w.credentials="include":f.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function d(f){if(f.ep)return;f.ep=!0;const w=s(f);fetch(f.href,w)}})();function yn(n){if(!(typeof window>"u")){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=n,document.head.appendChild(t),n}}function Jt(n,t){var s=n.__state.conversionName.toString(),d=Math.round(n.r),f=Math.round(n.g),w=Math.round(n.b),b=n.a,S=Math.round(n.h),P=n.s.toFixed(1),I=n.v.toFixed(1);if(t||s==="THREE_CHAR_HEX"||s==="SIX_CHAR_HEX"){for(var G=n.hex.toString(16);G.length<6;)G="0"+G;return"#"+G}else{if(s==="CSS_RGB")return"rgb("+d+","+f+","+w+")";if(s==="CSS_RGBA")return"rgba("+d+","+f+","+w+","+b+")";if(s==="HEX")return"0x"+n.hex.toString(16);if(s==="RGB_ARRAY")return"["+d+","+f+","+w+"]";if(s==="RGBA_ARRAY")return"["+d+","+f+","+w+","+b+"]";if(s==="RGB_OBJ")return"{r:"+d+",g:"+f+",b:"+w+"}";if(s==="RGBA_OBJ")return"{r:"+d+",g:"+f+",b:"+w+",a:"+b+"}";if(s==="HSV_OBJ")return"{h:"+S+",s:"+P+",v:"+I+"}";if(s==="HSVA_OBJ")return"{h:"+S+",s:"+P+",v:"+I+",a:"+b+"}"}return"unknown format"}var Be=Array.prototype.forEach,te=Array.prototype.slice,O={BREAK:{},extend:function(t){return this.each(te.call(arguments,1),function(s){var d=this.isObject(s)?Object.keys(s):[];d.forEach((function(f){this.isUndefined(s[f])||(t[f]=s[f])}).bind(this))},this),t},defaults:function(t){return this.each(te.call(arguments,1),function(s){var d=this.isObject(s)?Object.keys(s):[];d.forEach((function(f){this.isUndefined(t[f])&&(t[f]=s[f])}).bind(this))},this),t},compose:function(){var t=te.call(arguments);return function(){for(var s=te.call(arguments),d=t.length-1;d>=0;d--)s=[t[d].apply(this,s)];return s[0]}},each:function(t,s,d){if(t){if(Be&&t.forEach&&t.forEach===Be)t.forEach(s,d);else if(t.length===t.length+0){var f=void 0,w=void 0;for(f=0,w=t.length;f<w;f++)if(f in t&&s.call(d,t[f],f)===this.BREAK)return}else for(var b in t)if(s.call(d,t[b],b)===this.BREAK)return}},defer:function(t){setTimeout(t,0)},debounce:function(t,s,d){var f=void 0;return function(){var w=this,b=arguments;function S(){f=null,d||t.apply(w,b)}var P=d||!f;clearTimeout(f),f=setTimeout(S,s),P&&t.apply(w,b)}},toArray:function(t){return t.toArray?t.toArray():te.call(t)},isUndefined:function(t){return t===void 0},isNull:function(t){return t===null},isNaN:function(n){function t(s){return n.apply(this,arguments)}return t.toString=function(){return n.toString()},t}(function(n){return isNaN(n)}),isArray:Array.isArray||function(n){return n.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return t===!1||t===!0},isFunction:function(t){return t instanceof Function}},xn=[{litmus:O.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var s=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return s===null?!1:{space:"HEX",hex:parseInt("0x"+s[1].toString()+s[1].toString()+s[2].toString()+s[2].toString()+s[3].toString()+s[3].toString(),0)}},write:Jt},SIX_CHAR_HEX:{read:function(t){var s=t.match(/^#([A-F0-9]{6})$/i);return s===null?!1:{space:"HEX",hex:parseInt("0x"+s[1].toString(),0)}},write:Jt},CSS_RGB:{read:function(t){var s=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return s===null?!1:{space:"RGB",r:parseFloat(s[1]),g:parseFloat(s[2]),b:parseFloat(s[3])}},write:Jt},CSS_RGBA:{read:function(t){var s=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return s===null?!1:{space:"RGB",r:parseFloat(s[1]),g:parseFloat(s[2]),b:parseFloat(s[3]),a:parseFloat(s[4])}},write:Jt}}},{litmus:O.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:O.isArray,conversions:{RGB_ARRAY:{read:function(t){return t.length!==3?!1:{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return t.length!==4?!1:{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:O.isObject,conversions:{RGBA_OBJ:{read:function(t){return O.isNumber(t.r)&&O.isNumber(t.g)&&O.isNumber(t.b)&&O.isNumber(t.a)?{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}:!1},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return O.isNumber(t.r)&&O.isNumber(t.g)&&O.isNumber(t.b)?{space:"RGB",r:t.r,g:t.g,b:t.b}:!1},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return O.isNumber(t.h)&&O.isNumber(t.s)&&O.isNumber(t.v)&&O.isNumber(t.a)?{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}:!1},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return O.isNumber(t.h)&&O.isNumber(t.s)&&O.isNumber(t.v)?{space:"HSV",h:t.h,s:t.s,v:t.v}:!1},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],ee=void 0,pe=void 0,ve=function(){pe=!1;var t=arguments.length>1?O.toArray(arguments):arguments[0];return O.each(xn,function(s){if(s.litmus(t))return O.each(s.conversions,function(d,f){if(ee=d.read(t),pe===!1&&ee!==!1)return pe=ee,ee.conversionName=f,ee.conversion=d,O.BREAK}),O.BREAK}),pe},Ue=void 0,we={hsv_to_rgb:function(t,s,d){var f=Math.floor(t/60)%6,w=t/60-Math.floor(t/60),b=d*(1-s),S=d*(1-w*s),P=d*(1-(1-w)*s),I=[[d,P,b],[S,d,b],[b,d,P],[b,S,d],[P,b,d],[d,b,S]][f];return{r:I[0]*255,g:I[1]*255,b:I[2]*255}},rgb_to_hsv:function(t,s,d){var f=Math.min(t,s,d),w=Math.max(t,s,d),b=w-f,S=void 0,P=void 0;if(w!==0)P=b/w;else return{h:NaN,s:0,v:0};return t===w?S=(s-d)/b:s===w?S=2+(d-t)/b:S=4+(t-s)/b,S/=6,S<0&&(S+=1),{h:S*360,s:P,v:w/255}},rgb_to_hex:function(t,s,d){var f=this.hex_with_component(0,2,t);return f=this.hex_with_component(f,1,s),f=this.hex_with_component(f,0,d),f},component_from_hex:function(t,s){return t>>s*8&255},hex_with_component:function(t,s,d){return d<<(Ue=s*8)|t&~(255<<Ue)}},vn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},$t=function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")},qt=function(){function n(t,s){for(var d=0;d<s.length;d++){var f=s[d];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(t,f.key,f)}}return function(t,s,d){return s&&n(t.prototype,s),d&&n(t,d),t}}(),Yt=function n(t,s,d){t===null&&(t=Function.prototype);var f=Object.getOwnPropertyDescriptor(t,s);if(f===void 0){var w=Object.getPrototypeOf(t);return w===null?void 0:n(w,s,d)}else{if("value"in f)return f.value;var b=f.get;return b===void 0?void 0:b.call(d)}},Wt=function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)},jt=function(n,t){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:n},dt=function(){function n(){if($t(this,n),this.__state=ve.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return qt(n,[{key:"toString",value:function(){return Jt(this)}},{key:"toHexString",value:function(){return Jt(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),n}();function Te(n,t,s){Object.defineProperty(n,t,{get:function(){return this.__state.space==="RGB"?this.__state[t]:(dt.recalculateRGB(this,t,s),this.__state[t])},set:function(f){this.__state.space!=="RGB"&&(dt.recalculateRGB(this,t,s),this.__state.space="RGB"),this.__state[t]=f}})}function Pe(n,t){Object.defineProperty(n,t,{get:function(){return this.__state.space==="HSV"?this.__state[t]:(dt.recalculateHSV(this),this.__state[t])},set:function(d){this.__state.space!=="HSV"&&(dt.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=d}})}dt.recalculateRGB=function(n,t,s){if(n.__state.space==="HEX")n.__state[t]=we.component_from_hex(n.__state.hex,s);else if(n.__state.space==="HSV")O.extend(n.__state,we.hsv_to_rgb(n.__state.h,n.__state.s,n.__state.v));else throw new Error("Corrupted color state")};dt.recalculateHSV=function(n){var t=we.rgb_to_hsv(n.r,n.g,n.b);O.extend(n.__state,{s:t.s,v:t.v}),O.isNaN(t.h)?O.isUndefined(n.__state.h)&&(n.__state.h=0):n.__state.h=t.h};dt.COMPONENTS=["r","g","b","h","s","v","hex","a"];Te(dt.prototype,"r",2);Te(dt.prototype,"g",1);Te(dt.prototype,"b",0);Pe(dt.prototype,"h");Pe(dt.prototype,"s");Pe(dt.prototype,"v");Object.defineProperty(dt.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}});Object.defineProperty(dt.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=we.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var Kt=function(){function n(t,s){$t(this,n),this.initialValue=t[s],this.domElement=document.createElement("div"),this.object=t,this.property=s,this.__onChange=void 0,this.__onFinishChange=void 0}return qt(n,[{key:"onChange",value:function(s){return this.__onChange=s,this}},{key:"onFinishChange",value:function(s){return this.__onFinishChange=s,this}},{key:"setValue",value:function(s){return this.object[this.property]=s,this.__onChange&&this.__onChange.call(this,s),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),n}(),bn={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},sn={};O.each(bn,function(n,t){O.each(n,function(s){sn[s]=t})});var En=/(\d+(\.\d+)?)px/;function Xt(n){if(n==="0"||O.isUndefined(n))return 0;var t=n.match(En);return O.isNull(t)?0:parseFloat(t[1])}var D={makeSelectable:function(t,s){t===void 0||t.style===void 0||(t.onselectstart=s?function(){return!1}:function(){},t.style.MozUserSelect=s?"auto":"none",t.style.KhtmlUserSelect=s?"auto":"none",t.unselectable=s?"on":"off")},makeFullscreen:function(t,s,d){var f=d,w=s;O.isUndefined(w)&&(w=!0),O.isUndefined(f)&&(f=!0),t.style.position="absolute",w&&(t.style.left=0,t.style.right=0),f&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,s,d,f){var w=d||{},b=sn[s];if(!b)throw new Error("Event type "+s+" not supported.");var S=document.createEvent(b);switch(b){case"MouseEvents":{var P=w.x||w.clientX||0,I=w.y||w.clientY||0;S.initMouseEvent(s,w.bubbles||!1,w.cancelable||!0,window,w.clickCount||1,0,0,P,I,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var G=S.initKeyboardEvent||S.initKeyEvent;O.defaults(w,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),G(s,w.bubbles||!1,w.cancelable,window,w.ctrlKey,w.altKey,w.shiftKey,w.metaKey,w.keyCode,w.charCode);break}default:{S.initEvent(s,w.bubbles||!1,w.cancelable||!0);break}}O.defaults(S,f),t.dispatchEvent(S)},bind:function(t,s,d,f){var w=f||!1;return t.addEventListener?t.addEventListener(s,d,w):t.attachEvent&&t.attachEvent("on"+s,d),D},unbind:function(t,s,d,f){var w=f||!1;return t.removeEventListener?t.removeEventListener(s,d,w):t.detachEvent&&t.detachEvent("on"+s,d),D},addClass:function(t,s){if(t.className===void 0)t.className=s;else if(t.className!==s){var d=t.className.split(/ +/);d.indexOf(s)===-1&&(d.push(s),t.className=d.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return D},removeClass:function(t,s){if(s)if(t.className===s)t.removeAttribute("class");else{var d=t.className.split(/ +/),f=d.indexOf(s);f!==-1&&(d.splice(f,1),t.className=d.join(" "))}else t.className=void 0;return D},hasClass:function(t,s){return new RegExp("(?:^|\\s+)"+s+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var s=getComputedStyle(t);return Xt(s["border-left-width"])+Xt(s["border-right-width"])+Xt(s["padding-left"])+Xt(s["padding-right"])+Xt(s.width)},getHeight:function(t){var s=getComputedStyle(t);return Xt(s["border-top-width"])+Xt(s["border-bottom-width"])+Xt(s["padding-top"])+Xt(s["padding-bottom"])+Xt(s.height)},getOffset:function(t){var s=t,d={left:0,top:0};if(s.offsetParent)do d.left+=s.offsetLeft,d.top+=s.offsetTop,s=s.offsetParent;while(s);return d},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},on=function(n){Wt(t,n);function t(s,d){$t(this,t);var f=jt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s,d)),w=f;f.__prev=f.getValue(),f.__checkbox=document.createElement("input"),f.__checkbox.setAttribute("type","checkbox");function b(){w.setValue(!w.__prev)}return D.bind(f.__checkbox,"change",b,!1),f.domElement.appendChild(f.__checkbox),f.updateDisplay(),f}return qt(t,[{key:"setValue",value:function(d){var f=Yt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,d);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),f}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Yt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Kt),Mn=function(n){Wt(t,n);function t(s,d,f){$t(this,t);var w=jt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s,d)),b=f,S=w;if(w.__select=document.createElement("select"),O.isArray(b)){var P={};O.each(b,function(I){P[I]=I}),b=P}return O.each(b,function(I,G){var C=document.createElement("option");C.innerHTML=G,C.setAttribute("value",I),S.__select.appendChild(C)}),w.updateDisplay(),D.bind(w.__select,"change",function(){var I=this.options[this.selectedIndex].value;S.setValue(I)}),w.domElement.appendChild(w.__select),w}return qt(t,[{key:"setValue",value:function(d){var f=Yt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,d);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),f}},{key:"updateDisplay",value:function(){return D.isActive(this.__select)?this:(this.__select.value=this.getValue(),Yt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(Kt),Dn=function(n){Wt(t,n);function t(s,d){$t(this,t);var f=jt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s,d)),w=f;function b(){w.setValue(w.__input.value)}function S(){w.__onFinishChange&&w.__onFinishChange.call(w,w.getValue())}return f.__input=document.createElement("input"),f.__input.setAttribute("type","text"),D.bind(f.__input,"keyup",b),D.bind(f.__input,"change",b),D.bind(f.__input,"blur",S),D.bind(f.__input,"keydown",function(P){P.keyCode===13&&this.blur()}),f.updateDisplay(),f.domElement.appendChild(f.__input),f}return qt(t,[{key:"updateDisplay",value:function(){return D.isActive(this.__input)||(this.__input.value=this.getValue()),Yt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Kt);function Fe(n){var t=n.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var rn=function(n){Wt(t,n);function t(s,d,f){$t(this,t);var w=jt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s,d)),b=f||{};return w.__min=b.min,w.__max=b.max,w.__step=b.step,O.isUndefined(w.__step)?w.initialValue===0?w.__impliedStep=1:w.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(w.initialValue))/Math.LN10))/10:w.__impliedStep=w.__step,w.__precision=Fe(w.__impliedStep),w}return qt(t,[{key:"setValue",value:function(d){var f=d;return this.__min!==void 0&&f<this.__min?f=this.__min:this.__max!==void 0&&f>this.__max&&(f=this.__max),this.__step!==void 0&&f%this.__step!==0&&(f=Math.round(f/this.__step)*this.__step),Yt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,f)}},{key:"min",value:function(d){return this.__min=d,this}},{key:"max",value:function(d){return this.__max=d,this}},{key:"step",value:function(d){return this.__step=d,this.__impliedStep=d,this.__precision=Fe(d),this}}]),t}(Kt);function Sn(n,t){var s=Math.pow(10,t);return Math.round(n*s)/s}var me=function(n){Wt(t,n);function t(s,d,f){$t(this,t);var w=jt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s,d,f));w.__truncationSuspended=!1;var b=w,S=void 0;function P(){var W=parseFloat(b.__input.value);O.isNaN(W)||b.setValue(W)}function I(){b.__onFinishChange&&b.__onFinishChange.call(b,b.getValue())}function G(){I()}function C(W){var V=S-W.clientY;b.setValue(b.getValue()+V*b.__impliedStep),S=W.clientY}function $(){D.unbind(window,"mousemove",C),D.unbind(window,"mouseup",$),I()}function tt(W){D.bind(window,"mousemove",C),D.bind(window,"mouseup",$),S=W.clientY}return w.__input=document.createElement("input"),w.__input.setAttribute("type","text"),D.bind(w.__input,"change",P),D.bind(w.__input,"blur",G),D.bind(w.__input,"mousedown",tt),D.bind(w.__input,"keydown",function(W){W.keyCode===13&&(b.__truncationSuspended=!0,this.blur(),b.__truncationSuspended=!1,I())}),w.updateDisplay(),w.domElement.appendChild(w.__input),w}return qt(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():Sn(this.getValue(),this.__precision),Yt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(rn);function Ge(n,t,s,d,f){return d+(f-d)*((n-t)/(s-t))}var be=function(n){Wt(t,n);function t(s,d,f,w,b){$t(this,t);var S=jt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s,d,{min:f,max:w,step:b})),P=S;S.__background=document.createElement("div"),S.__foreground=document.createElement("div"),D.bind(S.__background,"mousedown",I),D.bind(S.__background,"touchstart",$),D.addClass(S.__background,"slider"),D.addClass(S.__foreground,"slider-fg");function I(V){document.activeElement.blur(),D.bind(window,"mousemove",G),D.bind(window,"mouseup",C),G(V)}function G(V){V.preventDefault();var J=P.__background.getBoundingClientRect();return P.setValue(Ge(V.clientX,J.left,J.right,P.__min,P.__max)),!1}function C(){D.unbind(window,"mousemove",G),D.unbind(window,"mouseup",C),P.__onFinishChange&&P.__onFinishChange.call(P,P.getValue())}function $(V){V.touches.length===1&&(D.bind(window,"touchmove",tt),D.bind(window,"touchend",W),tt(V))}function tt(V){var J=V.touches[0].clientX,st=P.__background.getBoundingClientRect();P.setValue(Ge(J,st.left,st.right,P.__min,P.__max))}function W(){D.unbind(window,"touchmove",tt),D.unbind(window,"touchend",W),P.__onFinishChange&&P.__onFinishChange.call(P,P.getValue())}return S.updateDisplay(),S.__background.appendChild(S.__foreground),S.domElement.appendChild(S.__background),S}return qt(t,[{key:"updateDisplay",value:function(){var d=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=d*100+"%",Yt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(rn),an=function(n){Wt(t,n);function t(s,d,f){$t(this,t);var w=jt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s,d)),b=w;return w.__button=document.createElement("div"),w.__button.innerHTML=f===void 0?"Fire":f,D.bind(w.__button,"click",function(S){return S.preventDefault(),b.fire(),!1}),D.addClass(w.__button,"button"),w.domElement.appendChild(w.__button),w}return qt(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(Kt),Ee=function(n){Wt(t,n);function t(s,d){$t(this,t);var f=jt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s,d));f.__color=new dt(f.getValue()),f.__temp=new dt(0);var w=f;f.domElement=document.createElement("div"),D.makeSelectable(f.domElement,!1),f.__selector=document.createElement("div"),f.__selector.className="selector",f.__saturation_field=document.createElement("div"),f.__saturation_field.className="saturation-field",f.__field_knob=document.createElement("div"),f.__field_knob.className="field-knob",f.__field_knob_border="2px solid ",f.__hue_knob=document.createElement("div"),f.__hue_knob.className="hue-knob",f.__hue_field=document.createElement("div"),f.__hue_field.className="hue-field",f.__input=document.createElement("input"),f.__input.type="text",f.__input_textShadow="0 1px 1px ",D.bind(f.__input,"keydown",function(V){V.keyCode===13&&C.call(this)}),D.bind(f.__input,"blur",C),D.bind(f.__selector,"mousedown",function(){D.addClass(this,"drag").bind(window,"mouseup",function(){D.removeClass(w.__selector,"drag")})}),D.bind(f.__selector,"touchstart",function(){D.addClass(this,"drag").bind(window,"touchend",function(){D.removeClass(w.__selector,"drag")})});var b=document.createElement("div");O.extend(f.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),O.extend(f.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:f.__field_knob_border+(f.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),O.extend(f.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),O.extend(f.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),O.extend(b.style,{width:"100%",height:"100%",background:"none"}),Ve(b,"top","rgba(0,0,0,0)","#000"),O.extend(f.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),Tn(f.__hue_field),O.extend(f.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:f.__input_textShadow+"rgba(0,0,0,0.7)"}),D.bind(f.__saturation_field,"mousedown",S),D.bind(f.__saturation_field,"touchstart",S),D.bind(f.__field_knob,"mousedown",S),D.bind(f.__field_knob,"touchstart",S),D.bind(f.__hue_field,"mousedown",P),D.bind(f.__hue_field,"touchstart",P);function S(V){tt(V),D.bind(window,"mousemove",tt),D.bind(window,"touchmove",tt),D.bind(window,"mouseup",I),D.bind(window,"touchend",I)}function P(V){W(V),D.bind(window,"mousemove",W),D.bind(window,"touchmove",W),D.bind(window,"mouseup",G),D.bind(window,"touchend",G)}function I(){D.unbind(window,"mousemove",tt),D.unbind(window,"touchmove",tt),D.unbind(window,"mouseup",I),D.unbind(window,"touchend",I),$()}function G(){D.unbind(window,"mousemove",W),D.unbind(window,"touchmove",W),D.unbind(window,"mouseup",G),D.unbind(window,"touchend",G),$()}function C(){var V=ve(this.value);V!==!1?(w.__color.__state=V,w.setValue(w.__color.toOriginal())):this.value=w.__color.toString()}function $(){w.__onFinishChange&&w.__onFinishChange.call(w,w.__color.toOriginal())}f.__saturation_field.appendChild(b),f.__selector.appendChild(f.__field_knob),f.__selector.appendChild(f.__saturation_field),f.__selector.appendChild(f.__hue_field),f.__hue_field.appendChild(f.__hue_knob),f.domElement.appendChild(f.__input),f.domElement.appendChild(f.__selector),f.updateDisplay();function tt(V){V.type.indexOf("touch")===-1&&V.preventDefault();var J=w.__saturation_field.getBoundingClientRect(),st=V.touches&&V.touches[0]||V,ut=st.clientX,it=st.clientY,lt=(ut-J.left)/(J.right-J.left),ot=1-(it-J.top)/(J.bottom-J.top);return ot>1?ot=1:ot<0&&(ot=0),lt>1?lt=1:lt<0&&(lt=0),w.__color.v=ot,w.__color.s=lt,w.setValue(w.__color.toOriginal()),!1}function W(V){V.type.indexOf("touch")===-1&&V.preventDefault();var J=w.__hue_field.getBoundingClientRect(),st=V.touches&&V.touches[0]||V,ut=st.clientY,it=1-(ut-J.top)/(J.bottom-J.top);return it>1?it=1:it<0&&(it=0),w.__color.h=it*360,w.setValue(w.__color.toOriginal()),!1}return f}return qt(t,[{key:"updateDisplay",value:function(){var d=ve(this.getValue());if(d!==!1){var f=!1;O.each(dt.COMPONENTS,function(S){if(!O.isUndefined(d[S])&&!O.isUndefined(this.__color.__state[S])&&d[S]!==this.__color.__state[S])return f=!0,{}},this),f&&O.extend(this.__color.__state,d)}O.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var w=this.__color.v<.5||this.__color.s>.5?255:0,b=255-w;O.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+w+","+w+","+w+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,Ve(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),O.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+w+","+w+","+w+")",textShadow:this.__input_textShadow+"rgba("+b+","+b+","+b+",.7)"})}}]),t}(Kt),An=["-moz-","-o-","-webkit-","-ms-",""];function Ve(n,t,s,d){n.style.background="",O.each(An,function(f){n.style.cssText+="background: "+f+"linear-gradient("+t+", "+s+" 0%, "+d+" 100%); "})}function Tn(n){n.style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var Pn={load:function(t,s){var d=s||document,f=d.createElement("link");f.type="text/css",f.rel="stylesheet",f.href=t,d.getElementsByTagName("head")[0].appendChild(f)},inject:function(t,s){var d=s||document,f=document.createElement("style");f.type="text/css",f.innerHTML=t;var w=d.getElementsByTagName("head")[0];try{w.appendChild(f)}catch{}}},On=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,kn=function(t,s){var d=t[s];return O.isArray(arguments[2])||O.isObject(arguments[2])?new Mn(t,s,arguments[2]):O.isNumber(d)?O.isNumber(arguments[2])&&O.isNumber(arguments[3])?O.isNumber(arguments[4])?new be(t,s,arguments[2],arguments[3],arguments[4]):new be(t,s,arguments[2],arguments[3]):O.isNumber(arguments[4])?new me(t,s,{min:arguments[2],max:arguments[3],step:arguments[4]}):new me(t,s,{min:arguments[2],max:arguments[3]}):O.isString(d)?new Dn(t,s):O.isFunction(d)?new an(t,s,""):O.isBoolean(d)?new on(t,s):null};function zn(n){setTimeout(n,1e3/60)}var Rn=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||zn,Cn=function(){function n(){$t(this,n),this.backgroundElement=document.createElement("div"),O.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),D.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),O.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;D.bind(this.backgroundElement,"click",function(){t.hide()})}return qt(n,[{key:"show",value:function(){var s=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),O.defer(function(){s.backgroundElement.style.opacity=1,s.domElement.style.opacity=1,s.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var s=this,d=function f(){s.domElement.style.display="none",s.backgroundElement.style.display="none",D.unbind(s.domElement,"webkitTransitionEnd",f),D.unbind(s.domElement,"transitionend",f),D.unbind(s.domElement,"oTransitionEnd",f)};D.bind(this.domElement,"webkitTransitionEnd",d),D.bind(this.domElement,"transitionend",d),D.bind(this.domElement,"oTransitionEnd",d),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-D.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-D.getHeight(this.domElement)/2+"px"}}]),n}(),Ln=yn(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);Pn.inject(Ln);var He="dg",$e=72,qe=20,re="Default",ne=function(){try{return!!window.localStorage}catch{return!1}}(),ie=void 0,Xe=!0,Qt=void 0,xe=!1,cn=[],et=function n(t){var s=this,d=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),D.addClass(this.domElement,He),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],d=O.defaults(d,{closeOnTop:!1,autoPlace:!0,width:n.DEFAULT_WIDTH}),d=O.defaults(d,{resizable:d.autoPlace,hideable:d.autoPlace}),O.isUndefined(d.load)?d.load={preset:re}:d.preset&&(d.load.preset=d.preset),O.isUndefined(d.parent)&&d.hideable&&cn.push(this),d.resizable=O.isUndefined(d.parent)&&d.resizable,d.autoPlace&&O.isUndefined(d.scrollable)&&(d.scrollable=!0);var f=ne&&localStorage.getItem(Zt(this,"isLocal"))==="true",w=void 0,b=void 0;if(Object.defineProperties(this,{parent:{get:function(){return d.parent}},scrollable:{get:function(){return d.scrollable}},autoPlace:{get:function(){return d.autoPlace}},closeOnTop:{get:function(){return d.closeOnTop}},preset:{get:function(){return s.parent?s.getRoot().preset:d.load.preset},set:function($){s.parent?s.getRoot().preset=$:d.load.preset=$,Un(this),s.revert()}},width:{get:function(){return d.width},set:function($){d.width=$,Se(s,$)}},name:{get:function(){return d.name},set:function($){d.name=$,b&&(b.innerHTML=d.name)}},closed:{get:function(){return d.closed},set:function($){d.closed=$,d.closed?D.addClass(s.__ul,n.CLASS_CLOSED):D.removeClass(s.__ul,n.CLASS_CLOSED),this.onResize(),s.__closeButton&&(s.__closeButton.innerHTML=$?n.TEXT_OPEN:n.TEXT_CLOSED)}},load:{get:function(){return d.load}},useLocalStorage:{get:function(){return f},set:function($){ne&&(f=$,$?D.bind(window,"unload",w):D.unbind(window,"unload",w),localStorage.setItem(Zt(s,"isLocal"),$))}}}),O.isUndefined(d.parent)){if(this.closed=d.closed||!1,D.addClass(this.domElement,n.CLASS_MAIN),D.makeSelectable(this.domElement,!1),ne&&f){s.useLocalStorage=!0;var S=localStorage.getItem(Zt(this,"gui"));S&&(d.load=JSON.parse(S))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=n.TEXT_CLOSED,D.addClass(this.__closeButton,n.CLASS_CLOSE_BUTTON),d.closeOnTop?(D.addClass(this.__closeButton,n.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(D.addClass(this.__closeButton,n.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),D.bind(this.__closeButton,"click",function(){s.closed=!s.closed})}else{d.closed===void 0&&(d.closed=!0);var P=document.createTextNode(d.name);D.addClass(P,"controller-name"),b=Oe(s,P);var I=function($){return $.preventDefault(),s.closed=!s.closed,!1};D.addClass(this.__ul,n.CLASS_CLOSED),D.addClass(b,"title"),D.bind(b,"click",I),d.closed||(this.closed=!1)}d.autoPlace&&(O.isUndefined(d.parent)&&(Xe&&(Qt=document.createElement("div"),D.addClass(Qt,He),D.addClass(Qt,n.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Qt),Xe=!1),Qt.appendChild(this.domElement),D.addClass(this.domElement,n.CLASS_AUTO_PLACE)),this.parent||Se(s,d.width)),this.__resizeHandler=function(){s.onResizeDebounced()},D.bind(window,"resize",this.__resizeHandler),D.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),D.bind(this.__ul,"transitionend",this.__resizeHandler),D.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),d.resizable&&Bn(this),w=function(){ne&&localStorage.getItem(Zt(s,"isLocal"))==="true"&&localStorage.setItem(Zt(s,"gui"),JSON.stringify(s.getSaveObject()))},this.saveToLocalStorageIfPossible=w;function G(){var C=s.getRoot();C.width+=1,O.defer(function(){C.width-=1})}d.parent||G()};et.toggleHide=function(){xe=!xe,O.each(cn,function(n){n.domElement.style.display=xe?"none":""})};et.CLASS_AUTO_PLACE="a";et.CLASS_AUTO_PLACE_CONTAINER="ac";et.CLASS_MAIN="main";et.CLASS_CONTROLLER_ROW="cr";et.CLASS_TOO_TALL="taller-than-window";et.CLASS_CLOSED="closed";et.CLASS_CLOSE_BUTTON="close-button";et.CLASS_CLOSE_TOP="close-top";et.CLASS_CLOSE_BOTTOM="close-bottom";et.CLASS_DRAG="drag";et.DEFAULT_WIDTH=245;et.TEXT_CLOSED="Close Controls";et.TEXT_OPEN="Open Controls";et._keydownHandler=function(n){document.activeElement.type!=="text"&&(n.which===$e||n.keyCode===$e)&&et.toggleHide()};D.bind(window,"keydown",et._keydownHandler,!1);O.extend(et.prototype,{add:function(t,s){return se(this,t,s,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,s){return se(this,t,s,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var s=this;O.defer(function(){s.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Qt.removeChild(this.domElement);var t=this;O.each(this.__folders,function(s){t.removeFolder(s)}),D.unbind(window,"keydown",et._keydownHandler,!1),Ye(this)},addFolder:function(t){if(this.__folders[t]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+t+'"');var s={name:t,parent:this};s.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(s.closed=this.load.folders[t].closed,s.load=this.load.folders[t]);var d=new et(s);this.__folders[t]=d;var f=Oe(this,d.domElement);return D.addClass(f,"folder"),d},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Ye(t);var s=this;O.each(t.__folders,function(d){t.removeFolder(d)}),O.defer(function(){s.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var s=D.getOffset(t.__ul).top,d=0;O.each(t.__ul.childNodes,function(f){t.autoPlace&&f===t.__save_row||(d+=D.getHeight(f))}),window.innerHeight-s-qe<d?(D.addClass(t.domElement,et.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-s-qe+"px"):(D.removeClass(t.domElement,et.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&O.defer(function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"}),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:O.debounce(function(){this.onResize()},50),remember:function(){if(O.isUndefined(ie)&&(ie=new Cn,ie.domElement.innerHTML=On),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;O.each(Array.prototype.slice.call(arguments),function(s){t.__rememberedObjects.length===0&&Nn(t),t.__rememberedObjects.indexOf(s)===-1&&t.__rememberedObjects.push(s)}),this.autoPlace&&Se(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=_e(this)),t.folders={},O.each(this.__folders,function(s,d){t.folders[d]=s.getSaveObject()}),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=_e(this),Me(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[re]=_e(this,!0)),this.load.remembered[t]=_e(this),this.preset=t,De(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){O.each(this.__controllers,function(s){this.getRoot().load.remembered?un(t||this.getRoot(),s):s.setValue(s.initialValue),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())},this),O.each(this.__folders,function(s){s.revert(s)}),t||Me(this.getRoot(),!1)},listen:function(t){var s=this.__listening.length===0;this.__listening.push(t),s&&ln(this.__listening)},updateDisplay:function(){O.each(this.__controllers,function(t){t.updateDisplay()}),O.each(this.__folders,function(t){t.updateDisplay()})}});function Oe(n,t,s){var d=document.createElement("li");return t&&d.appendChild(t),s?n.__ul.insertBefore(d,s):n.__ul.appendChild(d),n.onResize(),d}function Ye(n){D.unbind(window,"resize",n.__resizeHandler),n.saveToLocalStorageIfPossible&&D.unbind(window,"unload",n.saveToLocalStorageIfPossible)}function Me(n,t){var s=n.__preset_select[n.__preset_select.selectedIndex];t?s.innerHTML=s.value+"*":s.innerHTML=s.value}function In(n,t,s){if(s.__li=t,s.__gui=n,O.extend(s,{options:function(b){if(arguments.length>1){var S=s.__li.nextElementSibling;return s.remove(),se(n,s.object,s.property,{before:S,factoryArgs:[O.toArray(arguments)]})}if(O.isArray(b)||O.isObject(b)){var P=s.__li.nextElementSibling;return s.remove(),se(n,s.object,s.property,{before:P,factoryArgs:[b]})}},name:function(b){return s.__li.firstElementChild.firstElementChild.innerHTML=b,s},listen:function(){return s.__gui.listen(s),s},remove:function(){return s.__gui.remove(s),s}}),s instanceof be){var d=new me(s.object,s.property,{min:s.__min,max:s.__max,step:s.__step});O.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(w){var b=s[w],S=d[w];s[w]=d[w]=function(){var P=Array.prototype.slice.call(arguments);return S.apply(d,P),b.apply(s,P)}}),D.addClass(t,"has-slider"),s.domElement.insertBefore(d.domElement,s.domElement.firstElementChild)}else if(s instanceof me){var f=function(b){if(O.isNumber(s.__min)&&O.isNumber(s.__max)){var S=s.__li.firstElementChild.firstElementChild.innerHTML,P=s.__gui.__listening.indexOf(s)>-1;s.remove();var I=se(n,s.object,s.property,{before:s.__li.nextElementSibling,factoryArgs:[s.__min,s.__max,s.__step]});return I.name(S),P&&I.listen(),I}return b};s.min=O.compose(f,s.min),s.max=O.compose(f,s.max)}else s instanceof on?(D.bind(t,"click",function(){D.fakeEvent(s.__checkbox,"click")}),D.bind(s.__checkbox,"click",function(w){w.stopPropagation()})):s instanceof an?(D.bind(t,"click",function(){D.fakeEvent(s.__button,"click")}),D.bind(t,"mouseover",function(){D.addClass(s.__button,"hover")}),D.bind(t,"mouseout",function(){D.removeClass(s.__button,"hover")})):s instanceof Ee&&(D.addClass(t,"color"),s.updateDisplay=O.compose(function(w){return t.style.borderLeftColor=s.__color.toString(),w},s.updateDisplay),s.updateDisplay());s.setValue=O.compose(function(w){return n.getRoot().__preset_select&&s.isModified()&&Me(n.getRoot(),!0),w},s.setValue)}function un(n,t){var s=n.getRoot(),d=s.__rememberedObjects.indexOf(t.object);if(d!==-1){var f=s.__rememberedObjectIndecesToControllers[d];if(f===void 0&&(f={},s.__rememberedObjectIndecesToControllers[d]=f),f[t.property]=t,s.load&&s.load.remembered){var w=s.load.remembered,b=void 0;if(w[n.preset])b=w[n.preset];else if(w[re])b=w[re];else return;if(b[d]&&b[d][t.property]!==void 0){var S=b[d][t.property];t.initialValue=S,t.setValue(S)}}}}function se(n,t,s,d){if(t[s]===void 0)throw new Error('Object "'+t+'" has no property "'+s+'"');var f=void 0;if(d.color)f=new Ee(t,s);else{var w=[t,s].concat(d.factoryArgs);f=kn.apply(n,w)}d.before instanceof Kt&&(d.before=d.before.__li),un(n,f),D.addClass(f.domElement,"c");var b=document.createElement("span");D.addClass(b,"property-name"),b.innerHTML=f.property;var S=document.createElement("div");S.appendChild(b),S.appendChild(f.domElement);var P=Oe(n,S,d.before);return D.addClass(P,et.CLASS_CONTROLLER_ROW),f instanceof Ee?D.addClass(P,"color"):D.addClass(P,vn(f.getValue())),In(n,P,f),n.__controllers.push(f),f}function Zt(n,t){return document.location.href+"."+t}function De(n,t,s){var d=document.createElement("option");d.innerHTML=t,d.value=t,n.__preset_select.appendChild(d),s&&(n.__preset_select.selectedIndex=n.__preset_select.length-1)}function We(n,t){t.style.display=n.useLocalStorage?"block":"none"}function Nn(n){var t=n.__save_row=document.createElement("li");D.addClass(n.domElement,"has-save"),n.__ul.insertBefore(t,n.__ul.firstChild),D.addClass(t,"save-row");var s=document.createElement("span");s.innerHTML="&nbsp;",D.addClass(s,"button gears");var d=document.createElement("span");d.innerHTML="Save",D.addClass(d,"button"),D.addClass(d,"save");var f=document.createElement("span");f.innerHTML="New",D.addClass(f,"button"),D.addClass(f,"save-as");var w=document.createElement("span");w.innerHTML="Revert",D.addClass(w,"button"),D.addClass(w,"revert");var b=n.__preset_select=document.createElement("select");if(n.load&&n.load.remembered?O.each(n.load.remembered,function(C,$){De(n,$,$===n.preset)}):De(n,re,!1),D.bind(b,"change",function(){for(var C=0;C<n.__preset_select.length;C++)n.__preset_select[C].innerHTML=n.__preset_select[C].value;n.preset=this.value}),t.appendChild(b),t.appendChild(s),t.appendChild(d),t.appendChild(f),t.appendChild(w),ne){var S=document.getElementById("dg-local-explain"),P=document.getElementById("dg-local-storage"),I=document.getElementById("dg-save-locally");I.style.display="block",localStorage.getItem(Zt(n,"isLocal"))==="true"&&P.setAttribute("checked","checked"),We(n,S),D.bind(P,"change",function(){n.useLocalStorage=!n.useLocalStorage,We(n,S)})}var G=document.getElementById("dg-new-constructor");D.bind(G,"keydown",function(C){C.metaKey&&(C.which===67||C.keyCode===67)&&ie.hide()}),D.bind(s,"click",function(){G.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),ie.show(),G.focus(),G.select()}),D.bind(d,"click",function(){n.save()}),D.bind(f,"click",function(){var C=prompt("Enter a new preset name.");C&&n.saveAs(C)}),D.bind(w,"click",function(){n.revert()})}function Bn(n){var t=void 0;n.__resize_handle=document.createElement("div"),O.extend(n.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function s(w){return w.preventDefault(),n.width+=t-w.clientX,n.onResize(),t=w.clientX,!1}function d(){D.removeClass(n.__closeButton,et.CLASS_DRAG),D.unbind(window,"mousemove",s),D.unbind(window,"mouseup",d)}function f(w){return w.preventDefault(),t=w.clientX,D.addClass(n.__closeButton,et.CLASS_DRAG),D.bind(window,"mousemove",s),D.bind(window,"mouseup",d),!1}D.bind(n.__resize_handle,"mousedown",f),D.bind(n.__closeButton,"mousedown",f),n.domElement.insertBefore(n.__resize_handle,n.domElement.firstElementChild)}function Se(n,t){n.domElement.style.width=t+"px",n.__save_row&&n.autoPlace&&(n.__save_row.style.width=t+"px"),n.__closeButton&&(n.__closeButton.style.width=t+"px")}function _e(n,t){var s={};return O.each(n.__rememberedObjects,function(d,f){var w={},b=n.__rememberedObjectIndecesToControllers[f];O.each(b,function(S,P){w[P]=t?S.initialValue:S.getValue()}),s[f]=w}),s}function Un(n){for(var t=0;t<n.__preset_select.length;t++)n.__preset_select[t].value===n.preset&&(n.__preset_select.selectedIndex=t)}function ln(n){n.length!==0&&Rn.call(window,function(){ln(n)}),O.each(n,function(t){t.updateDisplay()})}var Fn=et;function Gn(n,t){return class extends n{constructor(...s){super(...s),t(this)}}}const Vn=Gn(Array,n=>n.fill(0));let X=1e-6;function Hn(n){function t(y=0,x=0){const v=new n(2);return y!==void 0&&(v[0]=y,x!==void 0&&(v[1]=x)),v}const s=t;function d(y,x,v){const e=v??new n(2);return e[0]=y,e[1]=x,e}function f(y,x){const v=x??new n(2);return v[0]=Math.ceil(y[0]),v[1]=Math.ceil(y[1]),v}function w(y,x){const v=x??new n(2);return v[0]=Math.floor(y[0]),v[1]=Math.floor(y[1]),v}function b(y,x){const v=x??new n(2);return v[0]=Math.round(y[0]),v[1]=Math.round(y[1]),v}function S(y,x=0,v=1,e){const h=e??new n(2);return h[0]=Math.min(v,Math.max(x,y[0])),h[1]=Math.min(v,Math.max(x,y[1])),h}function P(y,x,v){const e=v??new n(2);return e[0]=y[0]+x[0],e[1]=y[1]+x[1],e}function I(y,x,v,e){const h=e??new n(2);return h[0]=y[0]+x[0]*v,h[1]=y[1]+x[1]*v,h}function G(y,x){const v=y[0],e=y[1],h=x[0],r=x[1],c=Math.sqrt(v*v+e*e),o=Math.sqrt(h*h+r*r),u=c*o,m=u&&kt(y,x)/u;return Math.acos(m)}function C(y,x,v){const e=v??new n(2);return e[0]=y[0]-x[0],e[1]=y[1]-x[1],e}const $=C;function tt(y,x){return Math.abs(y[0]-x[0])<X&&Math.abs(y[1]-x[1])<X}function W(y,x){return y[0]===x[0]&&y[1]===x[1]}function V(y,x,v,e){const h=e??new n(2);return h[0]=y[0]+v*(x[0]-y[0]),h[1]=y[1]+v*(x[1]-y[1]),h}function J(y,x,v,e){const h=e??new n(2);return h[0]=y[0]+v[0]*(x[0]-y[0]),h[1]=y[1]+v[1]*(x[1]-y[1]),h}function st(y,x,v){const e=v??new n(2);return e[0]=Math.max(y[0],x[0]),e[1]=Math.max(y[1],x[1]),e}function ut(y,x,v){const e=v??new n(2);return e[0]=Math.min(y[0],x[0]),e[1]=Math.min(y[1],x[1]),e}function it(y,x,v){const e=v??new n(2);return e[0]=y[0]*x,e[1]=y[1]*x,e}const lt=it;function ot(y,x,v){const e=v??new n(2);return e[0]=y[0]/x,e[1]=y[1]/x,e}function Pt(y,x){const v=x??new n(2);return v[0]=1/y[0],v[1]=1/y[1],v}const Lt=Pt;function Ot(y,x,v){const e=v??new n(3),h=y[0]*x[1]-y[1]*x[0];return e[0]=0,e[1]=0,e[2]=h,e}function kt(y,x){return y[0]*x[0]+y[1]*x[1]}function ft(y){const x=y[0],v=y[1];return Math.sqrt(x*x+v*v)}const Ut=ft;function vt(y){const x=y[0],v=y[1];return x*x+v*v}const Ft=vt;function pt(y,x){const v=y[0]-x[0],e=y[1]-x[1];return Math.sqrt(v*v+e*e)}const j=pt;function K(y,x){const v=y[0]-x[0],e=y[1]-x[1];return v*v+e*e}const Y=K;function bt(y,x){const v=x??new n(2),e=y[0],h=y[1],r=Math.sqrt(e*e+h*h);return r>1e-5?(v[0]=e/r,v[1]=h/r):(v[0]=0,v[1]=0),v}function Gt(y,x){const v=x??new n(2);return v[0]=-y[0],v[1]=-y[1],v}function nt(y,x){const v=x??new n(2);return v[0]=y[0],v[1]=y[1],v}const Vt=nt;function At(y,x,v){const e=v??new n(2);return e[0]=y[0]*x[0],e[1]=y[1]*x[1],e}const Ht=At;function Tt(y,x,v){const e=v??new n(2);return e[0]=y[0]/x[0],e[1]=y[1]/x[1],e}const It=Tt;function Nt(y=1,x){const v=x??new n(2),e=Math.random()*2*Math.PI;return v[0]=Math.cos(e)*y,v[1]=Math.sin(e)*y,v}function E(y){const x=y??new n(2);return x[0]=0,x[1]=0,x}function k(y,x,v){const e=v??new n(2),h=y[0],r=y[1];return e[0]=h*x[0]+r*x[4]+x[12],e[1]=h*x[1]+r*x[5]+x[13],e}function g(y,x,v){const e=v??new n(2),h=y[0],r=y[1];return e[0]=x[0]*h+x[4]*r+x[8],e[1]=x[1]*h+x[5]*r+x[9],e}function i(y,x,v,e){const h=e??new n(2),r=y[0]-x[0],c=y[1]-x[1],o=Math.sin(v),u=Math.cos(v);return h[0]=r*u-c*o+x[0],h[1]=r*o+c*u+x[1],h}function l(y,x,v){const e=v??new n(2);return bt(y,e),it(e,x,e)}function a(y,x,v){const e=v??new n(2);return ft(y)>x?l(y,x,e):nt(y,e)}function p(y,x,v){const e=v??new n(2);return V(y,x,.5,e)}return{create:t,fromValues:s,set:d,ceil:f,floor:w,round:b,clamp:S,add:P,addScaled:I,angle:G,subtract:C,sub:$,equalsApproximately:tt,equals:W,lerp:V,lerpV:J,max:st,min:ut,mulScalar:it,scale:lt,divScalar:ot,inverse:Pt,invert:Lt,cross:Ot,dot:kt,length:ft,len:Ut,lengthSq:vt,lenSq:Ft,distance:pt,dist:j,distanceSq:K,distSq:Y,normalize:bt,negate:Gt,copy:nt,clone:Vt,multiply:At,mul:Ht,divide:Tt,div:It,random:Nt,zero:E,transformMat4:k,transformMat3:g,rotate:i,setLength:l,truncate:a,midpoint:p}}const je=new Map;function dn(n){let t=je.get(n);return t||(t=Hn(n),je.set(n,t)),t}function $n(n){function t(o,u,m){const _=new n(3);return o!==void 0&&(_[0]=o,u!==void 0&&(_[1]=u,m!==void 0&&(_[2]=m))),_}const s=t;function d(o,u,m,_){const M=_??new n(3);return M[0]=o,M[1]=u,M[2]=m,M}function f(o,u){const m=u??new n(3);return m[0]=Math.ceil(o[0]),m[1]=Math.ceil(o[1]),m[2]=Math.ceil(o[2]),m}function w(o,u){const m=u??new n(3);return m[0]=Math.floor(o[0]),m[1]=Math.floor(o[1]),m[2]=Math.floor(o[2]),m}function b(o,u){const m=u??new n(3);return m[0]=Math.round(o[0]),m[1]=Math.round(o[1]),m[2]=Math.round(o[2]),m}function S(o,u=0,m=1,_){const M=_??new n(3);return M[0]=Math.min(m,Math.max(u,o[0])),M[1]=Math.min(m,Math.max(u,o[1])),M[2]=Math.min(m,Math.max(u,o[2])),M}function P(o,u,m){const _=m??new n(3);return _[0]=o[0]+u[0],_[1]=o[1]+u[1],_[2]=o[2]+u[2],_}function I(o,u,m,_){const M=_??new n(3);return M[0]=o[0]+u[0]*m,M[1]=o[1]+u[1]*m,M[2]=o[2]+u[2]*m,M}function G(o,u){const m=o[0],_=o[1],M=o[2],A=u[0],T=u[1],L=u[2],z=Math.sqrt(m*m+_*_+M*M),R=Math.sqrt(A*A+T*T+L*L),B=z*R,H=B&&kt(o,u)/B;return Math.acos(H)}function C(o,u,m){const _=m??new n(3);return _[0]=o[0]-u[0],_[1]=o[1]-u[1],_[2]=o[2]-u[2],_}const $=C;function tt(o,u){return Math.abs(o[0]-u[0])<X&&Math.abs(o[1]-u[1])<X&&Math.abs(o[2]-u[2])<X}function W(o,u){return o[0]===u[0]&&o[1]===u[1]&&o[2]===u[2]}function V(o,u,m,_){const M=_??new n(3);return M[0]=o[0]+m*(u[0]-o[0]),M[1]=o[1]+m*(u[1]-o[1]),M[2]=o[2]+m*(u[2]-o[2]),M}function J(o,u,m,_){const M=_??new n(3);return M[0]=o[0]+m[0]*(u[0]-o[0]),M[1]=o[1]+m[1]*(u[1]-o[1]),M[2]=o[2]+m[2]*(u[2]-o[2]),M}function st(o,u,m){const _=m??new n(3);return _[0]=Math.max(o[0],u[0]),_[1]=Math.max(o[1],u[1]),_[2]=Math.max(o[2],u[2]),_}function ut(o,u,m){const _=m??new n(3);return _[0]=Math.min(o[0],u[0]),_[1]=Math.min(o[1],u[1]),_[2]=Math.min(o[2],u[2]),_}function it(o,u,m){const _=m??new n(3);return _[0]=o[0]*u,_[1]=o[1]*u,_[2]=o[2]*u,_}const lt=it;function ot(o,u,m){const _=m??new n(3);return _[0]=o[0]/u,_[1]=o[1]/u,_[2]=o[2]/u,_}function Pt(o,u){const m=u??new n(3);return m[0]=1/o[0],m[1]=1/o[1],m[2]=1/o[2],m}const Lt=Pt;function Ot(o,u,m){const _=m??new n(3),M=o[2]*u[0]-o[0]*u[2],A=o[0]*u[1]-o[1]*u[0];return _[0]=o[1]*u[2]-o[2]*u[1],_[1]=M,_[2]=A,_}function kt(o,u){return o[0]*u[0]+o[1]*u[1]+o[2]*u[2]}function ft(o){const u=o[0],m=o[1],_=o[2];return Math.sqrt(u*u+m*m+_*_)}const Ut=ft;function vt(o){const u=o[0],m=o[1],_=o[2];return u*u+m*m+_*_}const Ft=vt;function pt(o,u){const m=o[0]-u[0],_=o[1]-u[1],M=o[2]-u[2];return Math.sqrt(m*m+_*_+M*M)}const j=pt;function K(o,u){const m=o[0]-u[0],_=o[1]-u[1],M=o[2]-u[2];return m*m+_*_+M*M}const Y=K;function bt(o,u){const m=u??new n(3),_=o[0],M=o[1],A=o[2],T=Math.sqrt(_*_+M*M+A*A);return T>1e-5?(m[0]=_/T,m[1]=M/T,m[2]=A/T):(m[0]=0,m[1]=0,m[2]=0),m}function Gt(o,u){const m=u??new n(3);return m[0]=-o[0],m[1]=-o[1],m[2]=-o[2],m}function nt(o,u){const m=u??new n(3);return m[0]=o[0],m[1]=o[1],m[2]=o[2],m}const Vt=nt;function At(o,u,m){const _=m??new n(3);return _[0]=o[0]*u[0],_[1]=o[1]*u[1],_[2]=o[2]*u[2],_}const Ht=At;function Tt(o,u,m){const _=m??new n(3);return _[0]=o[0]/u[0],_[1]=o[1]/u[1],_[2]=o[2]/u[2],_}const It=Tt;function Nt(o=1,u){const m=u??new n(3),_=Math.random()*2*Math.PI,M=Math.random()*2-1,A=Math.sqrt(1-M*M)*o;return m[0]=Math.cos(_)*A,m[1]=Math.sin(_)*A,m[2]=M*o,m}function E(o){const u=o??new n(3);return u[0]=0,u[1]=0,u[2]=0,u}function k(o,u,m){const _=m??new n(3),M=o[0],A=o[1],T=o[2],L=u[3]*M+u[7]*A+u[11]*T+u[15]||1;return _[0]=(u[0]*M+u[4]*A+u[8]*T+u[12])/L,_[1]=(u[1]*M+u[5]*A+u[9]*T+u[13])/L,_[2]=(u[2]*M+u[6]*A+u[10]*T+u[14])/L,_}function g(o,u,m){const _=m??new n(3),M=o[0],A=o[1],T=o[2];return _[0]=M*u[0*4+0]+A*u[1*4+0]+T*u[2*4+0],_[1]=M*u[0*4+1]+A*u[1*4+1]+T*u[2*4+1],_[2]=M*u[0*4+2]+A*u[1*4+2]+T*u[2*4+2],_}function i(o,u,m){const _=m??new n(3),M=o[0],A=o[1],T=o[2];return _[0]=M*u[0]+A*u[4]+T*u[8],_[1]=M*u[1]+A*u[5]+T*u[9],_[2]=M*u[2]+A*u[6]+T*u[10],_}function l(o,u,m){const _=m??new n(3),M=u[0],A=u[1],T=u[2],L=u[3]*2,z=o[0],R=o[1],B=o[2],H=A*B-T*R,U=T*z-M*B,F=M*R-A*z;return _[0]=z+H*L+(A*F-T*U)*2,_[1]=R+U*L+(T*H-M*F)*2,_[2]=B+F*L+(M*U-A*H)*2,_}function a(o,u){const m=u??new n(3);return m[0]=o[12],m[1]=o[13],m[2]=o[14],m}function p(o,u,m){const _=m??new n(3),M=u*4;return _[0]=o[M+0],_[1]=o[M+1],_[2]=o[M+2],_}function y(o,u){const m=u??new n(3),_=o[0],M=o[1],A=o[2],T=o[4],L=o[5],z=o[6],R=o[8],B=o[9],H=o[10];return m[0]=Math.sqrt(_*_+M*M+A*A),m[1]=Math.sqrt(T*T+L*L+z*z),m[2]=Math.sqrt(R*R+B*B+H*H),m}function x(o,u,m,_){const M=_??new n(3),A=[],T=[];return A[0]=o[0]-u[0],A[1]=o[1]-u[1],A[2]=o[2]-u[2],T[0]=A[0],T[1]=A[1]*Math.cos(m)-A[2]*Math.sin(m),T[2]=A[1]*Math.sin(m)+A[2]*Math.cos(m),M[0]=T[0]+u[0],M[1]=T[1]+u[1],M[2]=T[2]+u[2],M}function v(o,u,m,_){const M=_??new n(3),A=[],T=[];return A[0]=o[0]-u[0],A[1]=o[1]-u[1],A[2]=o[2]-u[2],T[0]=A[2]*Math.sin(m)+A[0]*Math.cos(m),T[1]=A[1],T[2]=A[2]*Math.cos(m)-A[0]*Math.sin(m),M[0]=T[0]+u[0],M[1]=T[1]+u[1],M[2]=T[2]+u[2],M}function e(o,u,m,_){const M=_??new n(3),A=[],T=[];return A[0]=o[0]-u[0],A[1]=o[1]-u[1],A[2]=o[2]-u[2],T[0]=A[0]*Math.cos(m)-A[1]*Math.sin(m),T[1]=A[0]*Math.sin(m)+A[1]*Math.cos(m),T[2]=A[2],M[0]=T[0]+u[0],M[1]=T[1]+u[1],M[2]=T[2]+u[2],M}function h(o,u,m){const _=m??new n(3);return bt(o,_),it(_,u,_)}function r(o,u,m){const _=m??new n(3);return ft(o)>u?h(o,u,_):nt(o,_)}function c(o,u,m){const _=m??new n(3);return V(o,u,.5,_)}return{create:t,fromValues:s,set:d,ceil:f,floor:w,round:b,clamp:S,add:P,addScaled:I,angle:G,subtract:C,sub:$,equalsApproximately:tt,equals:W,lerp:V,lerpV:J,max:st,min:ut,mulScalar:it,scale:lt,divScalar:ot,inverse:Pt,invert:Lt,cross:Ot,dot:kt,length:ft,len:Ut,lengthSq:vt,lenSq:Ft,distance:pt,dist:j,distanceSq:K,distSq:Y,normalize:bt,negate:Gt,copy:nt,clone:Vt,multiply:At,mul:Ht,divide:Tt,div:It,random:Nt,zero:E,transformMat4:k,transformMat4Upper3x3:g,transformMat3:i,transformQuat:l,getTranslation:a,getAxis:p,getScaling:y,rotateX:x,rotateY:v,rotateZ:e,setLength:h,truncate:r,midpoint:c}}const Ke=new Map;function ye(n){let t=Ke.get(n);return t||(t=$n(n),Ke.set(n,t)),t}function qn(n){const t=dn(n),s=ye(n);function d(i,l,a,p,y,x,v,e,h){const r=new n(12);return r[3]=0,r[7]=0,r[11]=0,i!==void 0&&(r[0]=i,l!==void 0&&(r[1]=l,a!==void 0&&(r[2]=a,p!==void 0&&(r[4]=p,y!==void 0&&(r[5]=y,x!==void 0&&(r[6]=x,v!==void 0&&(r[8]=v,e!==void 0&&(r[9]=e,h!==void 0&&(r[10]=h))))))))),r}function f(i,l,a,p,y,x,v,e,h,r){const c=r??new n(12);return c[0]=i,c[1]=l,c[2]=a,c[3]=0,c[4]=p,c[5]=y,c[6]=x,c[7]=0,c[8]=v,c[9]=e,c[10]=h,c[11]=0,c}function w(i,l){const a=l??new n(12);return a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=0,a[4]=i[4],a[5]=i[5],a[6]=i[6],a[7]=0,a[8]=i[8],a[9]=i[9],a[10]=i[10],a[11]=0,a}function b(i,l){const a=l??new n(12),p=i[0],y=i[1],x=i[2],v=i[3],e=p+p,h=y+y,r=x+x,c=p*e,o=y*e,u=y*h,m=x*e,_=x*h,M=x*r,A=v*e,T=v*h,L=v*r;return a[0]=1-u-M,a[1]=o+L,a[2]=m-T,a[3]=0,a[4]=o-L,a[5]=1-c-M,a[6]=_+A,a[7]=0,a[8]=m+T,a[9]=_-A,a[10]=1-c-u,a[11]=0,a}function S(i,l){const a=l??new n(12);return a[0]=-i[0],a[1]=-i[1],a[2]=-i[2],a[4]=-i[4],a[5]=-i[5],a[6]=-i[6],a[8]=-i[8],a[9]=-i[9],a[10]=-i[10],a}function P(i,l,a){const p=a??new n(12);return p[0]=i[0]*l,p[1]=i[1]*l,p[2]=i[2]*l,p[4]=i[4]*l,p[5]=i[5]*l,p[6]=i[6]*l,p[8]=i[8]*l,p[9]=i[9]*l,p[10]=i[10]*l,p}const I=P;function G(i,l,a){const p=a??new n(12);return p[0]=i[0]+l[0],p[1]=i[1]+l[1],p[2]=i[2]+l[2],p[4]=i[4]+l[4],p[5]=i[5]+l[5],p[6]=i[6]+l[6],p[8]=i[8]+l[8],p[9]=i[9]+l[9],p[10]=i[10]+l[10],p}function C(i,l){const a=l??new n(12);return a[0]=i[0],a[1]=i[1],a[2]=i[2],a[4]=i[4],a[5]=i[5],a[6]=i[6],a[8]=i[8],a[9]=i[9],a[10]=i[10],a}const $=C;function tt(i,l){return Math.abs(i[0]-l[0])<X&&Math.abs(i[1]-l[1])<X&&Math.abs(i[2]-l[2])<X&&Math.abs(i[4]-l[4])<X&&Math.abs(i[5]-l[5])<X&&Math.abs(i[6]-l[6])<X&&Math.abs(i[8]-l[8])<X&&Math.abs(i[9]-l[9])<X&&Math.abs(i[10]-l[10])<X}function W(i,l){return i[0]===l[0]&&i[1]===l[1]&&i[2]===l[2]&&i[4]===l[4]&&i[5]===l[5]&&i[6]===l[6]&&i[8]===l[8]&&i[9]===l[9]&&i[10]===l[10]}function V(i){const l=i??new n(12);return l[0]=1,l[1]=0,l[2]=0,l[4]=0,l[5]=1,l[6]=0,l[8]=0,l[9]=0,l[10]=1,l}function J(i,l){const a=l??new n(12);if(a===i){let u;return u=i[1],i[1]=i[4],i[4]=u,u=i[2],i[2]=i[8],i[8]=u,u=i[6],i[6]=i[9],i[9]=u,a}const p=i[0*4+0],y=i[0*4+1],x=i[0*4+2],v=i[1*4+0],e=i[1*4+1],h=i[1*4+2],r=i[2*4+0],c=i[2*4+1],o=i[2*4+2];return a[0]=p,a[1]=v,a[2]=r,a[4]=y,a[5]=e,a[6]=c,a[8]=x,a[9]=h,a[10]=o,a}function st(i,l){const a=l??new n(12),p=i[0*4+0],y=i[0*4+1],x=i[0*4+2],v=i[1*4+0],e=i[1*4+1],h=i[1*4+2],r=i[2*4+0],c=i[2*4+1],o=i[2*4+2],u=o*e-h*c,m=-o*v+h*r,_=c*v-e*r,M=1/(p*u+y*m+x*_);return a[0]=u*M,a[1]=(-o*y+x*c)*M,a[2]=(h*y-x*e)*M,a[4]=m*M,a[5]=(o*p-x*r)*M,a[6]=(-h*p+x*v)*M,a[8]=_*M,a[9]=(-c*p+y*r)*M,a[10]=(e*p-y*v)*M,a}function ut(i){const l=i[0],a=i[0*4+1],p=i[0*4+2],y=i[1*4+0],x=i[1*4+1],v=i[1*4+2],e=i[2*4+0],h=i[2*4+1],r=i[2*4+2];return l*(x*r-h*v)-y*(a*r-h*p)+e*(a*v-x*p)}const it=st;function lt(i,l,a){const p=a??new n(12),y=i[0],x=i[1],v=i[2],e=i[4],h=i[5],r=i[6],c=i[8],o=i[9],u=i[10],m=l[0],_=l[1],M=l[2],A=l[4],T=l[5],L=l[6],z=l[8],R=l[9],B=l[10];return p[0]=y*m+e*_+c*M,p[1]=x*m+h*_+o*M,p[2]=v*m+r*_+u*M,p[4]=y*A+e*T+c*L,p[5]=x*A+h*T+o*L,p[6]=v*A+r*T+u*L,p[8]=y*z+e*R+c*B,p[9]=x*z+h*R+o*B,p[10]=v*z+r*R+u*B,p}const ot=lt;function Pt(i,l,a){const p=a??V();return i!==p&&(p[0]=i[0],p[1]=i[1],p[2]=i[2],p[4]=i[4],p[5]=i[5],p[6]=i[6]),p[8]=l[0],p[9]=l[1],p[10]=1,p}function Lt(i,l){const a=l??t.create();return a[0]=i[8],a[1]=i[9],a}function Ot(i,l,a){const p=a??t.create(),y=l*4;return p[0]=i[y+0],p[1]=i[y+1],p}function kt(i,l,a,p){const y=p===i?i:C(i,p),x=a*4;return y[x+0]=l[0],y[x+1]=l[1],y}function ft(i,l){const a=l??t.create(),p=i[0],y=i[1],x=i[4],v=i[5];return a[0]=Math.sqrt(p*p+y*y),a[1]=Math.sqrt(x*x+v*v),a}function Ut(i,l){const a=l??s.create(),p=i[0],y=i[1],x=i[2],v=i[4],e=i[5],h=i[6],r=i[8],c=i[9],o=i[10];return a[0]=Math.sqrt(p*p+y*y+x*x),a[1]=Math.sqrt(v*v+e*e+h*h),a[2]=Math.sqrt(r*r+c*c+o*o),a}function vt(i,l){const a=l??new n(12);return a[0]=1,a[1]=0,a[2]=0,a[4]=0,a[5]=1,a[6]=0,a[8]=i[0],a[9]=i[1],a[10]=1,a}function Ft(i,l,a){const p=a??new n(12),y=l[0],x=l[1],v=i[0],e=i[1],h=i[2],r=i[1*4+0],c=i[1*4+1],o=i[1*4+2],u=i[2*4+0],m=i[2*4+1],_=i[2*4+2];return i!==p&&(p[0]=v,p[1]=e,p[2]=h,p[4]=r,p[5]=c,p[6]=o),p[8]=v*y+r*x+u,p[9]=e*y+c*x+m,p[10]=h*y+o*x+_,p}function pt(i,l){const a=l??new n(12),p=Math.cos(i),y=Math.sin(i);return a[0]=p,a[1]=y,a[2]=0,a[4]=-y,a[5]=p,a[6]=0,a[8]=0,a[9]=0,a[10]=1,a}function j(i,l,a){const p=a??new n(12),y=i[0*4+0],x=i[0*4+1],v=i[0*4+2],e=i[1*4+0],h=i[1*4+1],r=i[1*4+2],c=Math.cos(l),o=Math.sin(l);return p[0]=c*y+o*e,p[1]=c*x+o*h,p[2]=c*v+o*r,p[4]=c*e-o*y,p[5]=c*h-o*x,p[6]=c*r-o*v,i!==p&&(p[8]=i[8],p[9]=i[9],p[10]=i[10]),p}function K(i,l){const a=l??new n(12),p=Math.cos(i),y=Math.sin(i);return a[0]=1,a[1]=0,a[2]=0,a[4]=0,a[5]=p,a[6]=y,a[8]=0,a[9]=-y,a[10]=p,a}function Y(i,l,a){const p=a??new n(12),y=i[4],x=i[5],v=i[6],e=i[8],h=i[9],r=i[10],c=Math.cos(l),o=Math.sin(l);return p[4]=c*y+o*e,p[5]=c*x+o*h,p[6]=c*v+o*r,p[8]=c*e-o*y,p[9]=c*h-o*x,p[10]=c*r-o*v,i!==p&&(p[0]=i[0],p[1]=i[1],p[2]=i[2]),p}function bt(i,l){const a=l??new n(12),p=Math.cos(i),y=Math.sin(i);return a[0]=p,a[1]=0,a[2]=-y,a[4]=0,a[5]=1,a[6]=0,a[8]=y,a[9]=0,a[10]=p,a}function Gt(i,l,a){const p=a??new n(12),y=i[0*4+0],x=i[0*4+1],v=i[0*4+2],e=i[2*4+0],h=i[2*4+1],r=i[2*4+2],c=Math.cos(l),o=Math.sin(l);return p[0]=c*y-o*e,p[1]=c*x-o*h,p[2]=c*v-o*r,p[8]=c*e+o*y,p[9]=c*h+o*x,p[10]=c*r+o*v,i!==p&&(p[4]=i[4],p[5]=i[5],p[6]=i[6]),p}const nt=pt,Vt=j;function At(i,l){const a=l??new n(12);return a[0]=i[0],a[1]=0,a[2]=0,a[4]=0,a[5]=i[1],a[6]=0,a[8]=0,a[9]=0,a[10]=1,a}function Ht(i,l,a){const p=a??new n(12),y=l[0],x=l[1];return p[0]=y*i[0*4+0],p[1]=y*i[0*4+1],p[2]=y*i[0*4+2],p[4]=x*i[1*4+0],p[5]=x*i[1*4+1],p[6]=x*i[1*4+2],i!==p&&(p[8]=i[8],p[9]=i[9],p[10]=i[10]),p}function Tt(i,l){const a=l??new n(12);return a[0]=i[0],a[1]=0,a[2]=0,a[4]=0,a[5]=i[1],a[6]=0,a[8]=0,a[9]=0,a[10]=i[2],a}function It(i,l,a){const p=a??new n(12),y=l[0],x=l[1],v=l[2];return p[0]=y*i[0*4+0],p[1]=y*i[0*4+1],p[2]=y*i[0*4+2],p[4]=x*i[1*4+0],p[5]=x*i[1*4+1],p[6]=x*i[1*4+2],p[8]=v*i[2*4+0],p[9]=v*i[2*4+1],p[10]=v*i[2*4+2],p}function Nt(i,l){const a=l??new n(12);return a[0]=i,a[1]=0,a[2]=0,a[4]=0,a[5]=i,a[6]=0,a[8]=0,a[9]=0,a[10]=1,a}function E(i,l,a){const p=a??new n(12);return p[0]=l*i[0*4+0],p[1]=l*i[0*4+1],p[2]=l*i[0*4+2],p[4]=l*i[1*4+0],p[5]=l*i[1*4+1],p[6]=l*i[1*4+2],i!==p&&(p[8]=i[8],p[9]=i[9],p[10]=i[10]),p}function k(i,l){const a=l??new n(12);return a[0]=i,a[1]=0,a[2]=0,a[4]=0,a[5]=i,a[6]=0,a[8]=0,a[9]=0,a[10]=i,a}function g(i,l,a){const p=a??new n(12);return p[0]=l*i[0*4+0],p[1]=l*i[0*4+1],p[2]=l*i[0*4+2],p[4]=l*i[1*4+0],p[5]=l*i[1*4+1],p[6]=l*i[1*4+2],p[8]=l*i[2*4+0],p[9]=l*i[2*4+1],p[10]=l*i[2*4+2],p}return{add:G,clone:$,copy:C,create:d,determinant:ut,equals:W,equalsApproximately:tt,fromMat4:w,fromQuat:b,get3DScaling:Ut,getAxis:Ot,getScaling:ft,getTranslation:Lt,identity:V,inverse:st,invert:it,mul:ot,mulScalar:I,multiply:lt,multiplyScalar:P,negate:S,rotate:j,rotateX:Y,rotateY:Gt,rotateZ:Vt,rotation:pt,rotationX:K,rotationY:bt,rotationZ:nt,scale:Ht,scale3D:It,scaling:At,scaling3D:Tt,set:f,setAxis:kt,setTranslation:Pt,translate:Ft,translation:vt,transpose:J,uniformScale:E,uniformScale3D:g,uniformScaling:Nt,uniformScaling3D:k}}const Qe=new Map;function Xn(n){let t=Qe.get(n);return t||(t=qn(n),Qe.set(n,t)),t}function Yn(n){const t=ye(n);function s(e,h,r,c,o,u,m,_,M,A,T,L,z,R,B,H){const U=new n(16);return e!==void 0&&(U[0]=e,h!==void 0&&(U[1]=h,r!==void 0&&(U[2]=r,c!==void 0&&(U[3]=c,o!==void 0&&(U[4]=o,u!==void 0&&(U[5]=u,m!==void 0&&(U[6]=m,_!==void 0&&(U[7]=_,M!==void 0&&(U[8]=M,A!==void 0&&(U[9]=A,T!==void 0&&(U[10]=T,L!==void 0&&(U[11]=L,z!==void 0&&(U[12]=z,R!==void 0&&(U[13]=R,B!==void 0&&(U[14]=B,H!==void 0&&(U[15]=H)))))))))))))))),U}function d(e,h,r,c,o,u,m,_,M,A,T,L,z,R,B,H,U){const F=U??new n(16);return F[0]=e,F[1]=h,F[2]=r,F[3]=c,F[4]=o,F[5]=u,F[6]=m,F[7]=_,F[8]=M,F[9]=A,F[10]=T,F[11]=L,F[12]=z,F[13]=R,F[14]=B,F[15]=H,F}function f(e,h){const r=h??new n(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=0,r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=0,r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function w(e,h){const r=h??new n(16),c=e[0],o=e[1],u=e[2],m=e[3],_=c+c,M=o+o,A=u+u,T=c*_,L=o*_,z=o*M,R=u*_,B=u*M,H=u*A,U=m*_,F=m*M,Z=m*A;return r[0]=1-z-H,r[1]=L+Z,r[2]=R-F,r[3]=0,r[4]=L-Z,r[5]=1-T-H,r[6]=B+U,r[7]=0,r[8]=R+F,r[9]=B-U,r[10]=1-T-z,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function b(e,h){const r=h??new n(16);return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3],r[4]=-e[4],r[5]=-e[5],r[6]=-e[6],r[7]=-e[7],r[8]=-e[8],r[9]=-e[9],r[10]=-e[10],r[11]=-e[11],r[12]=-e[12],r[13]=-e[13],r[14]=-e[14],r[15]=-e[15],r}function S(e,h,r){const c=r??new n(16);return c[0]=e[0]+h[0],c[1]=e[1]+h[1],c[2]=e[2]+h[2],c[3]=e[3]+h[3],c[4]=e[4]+h[4],c[5]=e[5]+h[5],c[6]=e[6]+h[6],c[7]=e[7]+h[7],c[8]=e[8]+h[8],c[9]=e[9]+h[9],c[10]=e[10]+h[10],c[11]=e[11]+h[11],c[12]=e[12]+h[12],c[13]=e[13]+h[13],c[14]=e[14]+h[14],c[15]=e[15]+h[15],c}function P(e,h,r){const c=r??new n(16);return c[0]=e[0]*h,c[1]=e[1]*h,c[2]=e[2]*h,c[3]=e[3]*h,c[4]=e[4]*h,c[5]=e[5]*h,c[6]=e[6]*h,c[7]=e[7]*h,c[8]=e[8]*h,c[9]=e[9]*h,c[10]=e[10]*h,c[11]=e[11]*h,c[12]=e[12]*h,c[13]=e[13]*h,c[14]=e[14]*h,c[15]=e[15]*h,c}const I=P;function G(e,h){const r=h??new n(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}const C=G;function $(e,h){return Math.abs(e[0]-h[0])<X&&Math.abs(e[1]-h[1])<X&&Math.abs(e[2]-h[2])<X&&Math.abs(e[3]-h[3])<X&&Math.abs(e[4]-h[4])<X&&Math.abs(e[5]-h[5])<X&&Math.abs(e[6]-h[6])<X&&Math.abs(e[7]-h[7])<X&&Math.abs(e[8]-h[8])<X&&Math.abs(e[9]-h[9])<X&&Math.abs(e[10]-h[10])<X&&Math.abs(e[11]-h[11])<X&&Math.abs(e[12]-h[12])<X&&Math.abs(e[13]-h[13])<X&&Math.abs(e[14]-h[14])<X&&Math.abs(e[15]-h[15])<X}function tt(e,h){return e[0]===h[0]&&e[1]===h[1]&&e[2]===h[2]&&e[3]===h[3]&&e[4]===h[4]&&e[5]===h[5]&&e[6]===h[6]&&e[7]===h[7]&&e[8]===h[8]&&e[9]===h[9]&&e[10]===h[10]&&e[11]===h[11]&&e[12]===h[12]&&e[13]===h[13]&&e[14]===h[14]&&e[15]===h[15]}function W(e){const h=e??new n(16);return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function V(e,h){const r=h??new n(16);if(r===e){let Q;return Q=e[1],e[1]=e[4],e[4]=Q,Q=e[2],e[2]=e[8],e[8]=Q,Q=e[3],e[3]=e[12],e[12]=Q,Q=e[6],e[6]=e[9],e[9]=Q,Q=e[7],e[7]=e[13],e[13]=Q,Q=e[11],e[11]=e[14],e[14]=Q,r}const c=e[0*4+0],o=e[0*4+1],u=e[0*4+2],m=e[0*4+3],_=e[1*4+0],M=e[1*4+1],A=e[1*4+2],T=e[1*4+3],L=e[2*4+0],z=e[2*4+1],R=e[2*4+2],B=e[2*4+3],H=e[3*4+0],U=e[3*4+1],F=e[3*4+2],Z=e[3*4+3];return r[0]=c,r[1]=_,r[2]=L,r[3]=H,r[4]=o,r[5]=M,r[6]=z,r[7]=U,r[8]=u,r[9]=A,r[10]=R,r[11]=F,r[12]=m,r[13]=T,r[14]=B,r[15]=Z,r}function J(e,h){const r=h??new n(16),c=e[0*4+0],o=e[0*4+1],u=e[0*4+2],m=e[0*4+3],_=e[1*4+0],M=e[1*4+1],A=e[1*4+2],T=e[1*4+3],L=e[2*4+0],z=e[2*4+1],R=e[2*4+2],B=e[2*4+3],H=e[3*4+0],U=e[3*4+1],F=e[3*4+2],Z=e[3*4+3],Q=R*Z,rt=F*B,at=A*Z,ct=F*T,ht=A*B,_t=R*T,gt=u*Z,wt=F*m,mt=u*B,yt=R*m,Et=u*T,Mt=A*m,Dt=L*U,St=H*z,zt=_*U,Rt=H*M,Ct=_*z,ae=L*M,ce=c*U,ue=H*o,le=c*z,de=L*o,fe=c*M,he=_*o,Ce=Q*M+ct*z+ht*U-(rt*M+at*z+_t*U),Le=rt*o+gt*z+yt*U-(Q*o+wt*z+mt*U),Ie=at*o+wt*M+Et*U-(ct*o+gt*M+Mt*U),Ne=_t*o+mt*M+Mt*z-(ht*o+yt*M+Et*z),xt=1/(c*Ce+_*Le+L*Ie+H*Ne);return r[0]=xt*Ce,r[1]=xt*Le,r[2]=xt*Ie,r[3]=xt*Ne,r[4]=xt*(rt*_+at*L+_t*H-(Q*_+ct*L+ht*H)),r[5]=xt*(Q*c+wt*L+mt*H-(rt*c+gt*L+yt*H)),r[6]=xt*(ct*c+gt*_+Mt*H-(at*c+wt*_+Et*H)),r[7]=xt*(ht*c+yt*_+Et*L-(_t*c+mt*_+Mt*L)),r[8]=xt*(Dt*T+Rt*B+Ct*Z-(St*T+zt*B+ae*Z)),r[9]=xt*(St*m+ce*B+de*Z-(Dt*m+ue*B+le*Z)),r[10]=xt*(zt*m+ue*T+fe*Z-(Rt*m+ce*T+he*Z)),r[11]=xt*(ae*m+le*T+he*B-(Ct*m+de*T+fe*B)),r[12]=xt*(zt*R+ae*F+St*A-(Ct*F+Dt*A+Rt*R)),r[13]=xt*(le*F+Dt*u+ue*R-(ce*R+de*F+St*u)),r[14]=xt*(ce*A+he*F+Rt*u-(fe*F+zt*u+ue*A)),r[15]=xt*(fe*R+Ct*u+de*A-(le*A+he*R+ae*u)),r}function st(e){const h=e[0],r=e[0*4+1],c=e[0*4+2],o=e[0*4+3],u=e[1*4+0],m=e[1*4+1],_=e[1*4+2],M=e[1*4+3],A=e[2*4+0],T=e[2*4+1],L=e[2*4+2],z=e[2*4+3],R=e[3*4+0],B=e[3*4+1],H=e[3*4+2],U=e[3*4+3],F=L*U,Z=H*z,Q=_*U,rt=H*M,at=_*z,ct=L*M,ht=c*U,_t=H*o,gt=c*z,wt=L*o,mt=c*M,yt=_*o,Et=F*m+rt*T+at*B-(Z*m+Q*T+ct*B),Mt=Z*r+ht*T+wt*B-(F*r+_t*T+gt*B),Dt=Q*r+_t*m+mt*B-(rt*r+ht*m+yt*B),St=ct*r+gt*m+yt*T-(at*r+wt*m+mt*T);return h*Et+u*Mt+A*Dt+R*St}const ut=J;function it(e,h,r){const c=r??new n(16),o=e[0],u=e[1],m=e[2],_=e[3],M=e[4],A=e[5],T=e[6],L=e[7],z=e[8],R=e[9],B=e[10],H=e[11],U=e[12],F=e[13],Z=e[14],Q=e[15],rt=h[0],at=h[1],ct=h[2],ht=h[3],_t=h[4],gt=h[5],wt=h[6],mt=h[7],yt=h[8],Et=h[9],Mt=h[10],Dt=h[11],St=h[12],zt=h[13],Rt=h[14],Ct=h[15];return c[0]=o*rt+M*at+z*ct+U*ht,c[1]=u*rt+A*at+R*ct+F*ht,c[2]=m*rt+T*at+B*ct+Z*ht,c[3]=_*rt+L*at+H*ct+Q*ht,c[4]=o*_t+M*gt+z*wt+U*mt,c[5]=u*_t+A*gt+R*wt+F*mt,c[6]=m*_t+T*gt+B*wt+Z*mt,c[7]=_*_t+L*gt+H*wt+Q*mt,c[8]=o*yt+M*Et+z*Mt+U*Dt,c[9]=u*yt+A*Et+R*Mt+F*Dt,c[10]=m*yt+T*Et+B*Mt+Z*Dt,c[11]=_*yt+L*Et+H*Mt+Q*Dt,c[12]=o*St+M*zt+z*Rt+U*Ct,c[13]=u*St+A*zt+R*Rt+F*Ct,c[14]=m*St+T*zt+B*Rt+Z*Ct,c[15]=_*St+L*zt+H*Rt+Q*Ct,c}const lt=it;function ot(e,h,r){const c=r??W();return e!==c&&(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3],c[4]=e[4],c[5]=e[5],c[6]=e[6],c[7]=e[7],c[8]=e[8],c[9]=e[9],c[10]=e[10],c[11]=e[11]),c[12]=h[0],c[13]=h[1],c[14]=h[2],c[15]=1,c}function Pt(e,h){const r=h??t.create();return r[0]=e[12],r[1]=e[13],r[2]=e[14],r}function Lt(e,h,r){const c=r??t.create(),o=h*4;return c[0]=e[o+0],c[1]=e[o+1],c[2]=e[o+2],c}function Ot(e,h,r,c){const o=c===e?c:G(e,c),u=r*4;return o[u+0]=h[0],o[u+1]=h[1],o[u+2]=h[2],o}function kt(e,h){const r=h??t.create(),c=e[0],o=e[1],u=e[2],m=e[4],_=e[5],M=e[6],A=e[8],T=e[9],L=e[10];return r[0]=Math.sqrt(c*c+o*o+u*u),r[1]=Math.sqrt(m*m+_*_+M*M),r[2]=Math.sqrt(A*A+T*T+L*L),r}function ft(e,h,r,c,o){const u=o??new n(16),m=Math.tan(Math.PI*.5-.5*e);if(u[0]=m/h,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=m,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,Number.isFinite(c)){const _=1/(r-c);u[10]=c*_,u[14]=c*r*_}else u[10]=-1,u[14]=-r;return u}function Ut(e,h,r,c=1/0,o){const u=o??new n(16),m=1/Math.tan(e*.5);if(u[0]=m/h,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=m,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,c===1/0)u[10]=0,u[14]=r;else{const _=1/(c-r);u[10]=r*_,u[14]=c*r*_}return u}function vt(e,h,r,c,o,u,m){const _=m??new n(16);return _[0]=2/(h-e),_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2/(c-r),_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1/(o-u),_[11]=0,_[12]=(h+e)/(e-h),_[13]=(c+r)/(r-c),_[14]=o/(o-u),_[15]=1,_}function Ft(e,h,r,c,o,u,m){const _=m??new n(16),M=h-e,A=c-r,T=o-u;return _[0]=2*o/M,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*o/A,_[6]=0,_[7]=0,_[8]=(e+h)/M,_[9]=(c+r)/A,_[10]=u/T,_[11]=-1,_[12]=0,_[13]=0,_[14]=o*u/T,_[15]=0,_}function pt(e,h,r,c,o,u=1/0,m){const _=m??new n(16),M=h-e,A=c-r;if(_[0]=2*o/M,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*o/A,_[6]=0,_[7]=0,_[8]=(e+h)/M,_[9]=(c+r)/A,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,u===1/0)_[10]=0,_[14]=o;else{const T=1/(u-o);_[10]=o*T,_[14]=u*o*T}return _}const j=t.create(),K=t.create(),Y=t.create();function bt(e,h,r,c){const o=c??new n(16);return t.normalize(t.subtract(h,e,Y),Y),t.normalize(t.cross(r,Y,j),j),t.normalize(t.cross(Y,j,K),K),o[0]=j[0],o[1]=j[1],o[2]=j[2],o[3]=0,o[4]=K[0],o[5]=K[1],o[6]=K[2],o[7]=0,o[8]=Y[0],o[9]=Y[1],o[10]=Y[2],o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}function Gt(e,h,r,c){const o=c??new n(16);return t.normalize(t.subtract(e,h,Y),Y),t.normalize(t.cross(r,Y,j),j),t.normalize(t.cross(Y,j,K),K),o[0]=j[0],o[1]=j[1],o[2]=j[2],o[3]=0,o[4]=K[0],o[5]=K[1],o[6]=K[2],o[7]=0,o[8]=Y[0],o[9]=Y[1],o[10]=Y[2],o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}function nt(e,h,r,c){const o=c??new n(16);return t.normalize(t.subtract(e,h,Y),Y),t.normalize(t.cross(r,Y,j),j),t.normalize(t.cross(Y,j,K),K),o[0]=j[0],o[1]=K[0],o[2]=Y[0],o[3]=0,o[4]=j[1],o[5]=K[1],o[6]=Y[1],o[7]=0,o[8]=j[2],o[9]=K[2],o[10]=Y[2],o[11]=0,o[12]=-(j[0]*e[0]+j[1]*e[1]+j[2]*e[2]),o[13]=-(K[0]*e[0]+K[1]*e[1]+K[2]*e[2]),o[14]=-(Y[0]*e[0]+Y[1]*e[1]+Y[2]*e[2]),o[15]=1,o}function Vt(e,h){const r=h??new n(16);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function At(e,h,r){const c=r??new n(16),o=h[0],u=h[1],m=h[2],_=e[0],M=e[1],A=e[2],T=e[3],L=e[1*4+0],z=e[1*4+1],R=e[1*4+2],B=e[1*4+3],H=e[2*4+0],U=e[2*4+1],F=e[2*4+2],Z=e[2*4+3],Q=e[3*4+0],rt=e[3*4+1],at=e[3*4+2],ct=e[3*4+3];return e!==c&&(c[0]=_,c[1]=M,c[2]=A,c[3]=T,c[4]=L,c[5]=z,c[6]=R,c[7]=B,c[8]=H,c[9]=U,c[10]=F,c[11]=Z),c[12]=_*o+L*u+H*m+Q,c[13]=M*o+z*u+U*m+rt,c[14]=A*o+R*u+F*m+at,c[15]=T*o+B*u+Z*m+ct,c}function Ht(e,h){const r=h??new n(16),c=Math.cos(e),o=Math.sin(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=c,r[6]=o,r[7]=0,r[8]=0,r[9]=-o,r[10]=c,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Tt(e,h,r){const c=r??new n(16),o=e[4],u=e[5],m=e[6],_=e[7],M=e[8],A=e[9],T=e[10],L=e[11],z=Math.cos(h),R=Math.sin(h);return c[4]=z*o+R*M,c[5]=z*u+R*A,c[6]=z*m+R*T,c[7]=z*_+R*L,c[8]=z*M-R*o,c[9]=z*A-R*u,c[10]=z*T-R*m,c[11]=z*L-R*_,e!==c&&(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3],c[12]=e[12],c[13]=e[13],c[14]=e[14],c[15]=e[15]),c}function It(e,h){const r=h??new n(16),c=Math.cos(e),o=Math.sin(e);return r[0]=c,r[1]=0,r[2]=-o,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=o,r[9]=0,r[10]=c,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Nt(e,h,r){const c=r??new n(16),o=e[0*4+0],u=e[0*4+1],m=e[0*4+2],_=e[0*4+3],M=e[2*4+0],A=e[2*4+1],T=e[2*4+2],L=e[2*4+3],z=Math.cos(h),R=Math.sin(h);return c[0]=z*o-R*M,c[1]=z*u-R*A,c[2]=z*m-R*T,c[3]=z*_-R*L,c[8]=z*M+R*o,c[9]=z*A+R*u,c[10]=z*T+R*m,c[11]=z*L+R*_,e!==c&&(c[4]=e[4],c[5]=e[5],c[6]=e[6],c[7]=e[7],c[12]=e[12],c[13]=e[13],c[14]=e[14],c[15]=e[15]),c}function E(e,h){const r=h??new n(16),c=Math.cos(e),o=Math.sin(e);return r[0]=c,r[1]=o,r[2]=0,r[3]=0,r[4]=-o,r[5]=c,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function k(e,h,r){const c=r??new n(16),o=e[0*4+0],u=e[0*4+1],m=e[0*4+2],_=e[0*4+3],M=e[1*4+0],A=e[1*4+1],T=e[1*4+2],L=e[1*4+3],z=Math.cos(h),R=Math.sin(h);return c[0]=z*o+R*M,c[1]=z*u+R*A,c[2]=z*m+R*T,c[3]=z*_+R*L,c[4]=z*M-R*o,c[5]=z*A-R*u,c[6]=z*T-R*m,c[7]=z*L-R*_,e!==c&&(c[8]=e[8],c[9]=e[9],c[10]=e[10],c[11]=e[11],c[12]=e[12],c[13]=e[13],c[14]=e[14],c[15]=e[15]),c}function g(e,h,r){const c=r??new n(16);let o=e[0],u=e[1],m=e[2];const _=Math.sqrt(o*o+u*u+m*m);o/=_,u/=_,m/=_;const M=o*o,A=u*u,T=m*m,L=Math.cos(h),z=Math.sin(h),R=1-L;return c[0]=M+(1-M)*L,c[1]=o*u*R+m*z,c[2]=o*m*R-u*z,c[3]=0,c[4]=o*u*R-m*z,c[5]=A+(1-A)*L,c[6]=u*m*R+o*z,c[7]=0,c[8]=o*m*R+u*z,c[9]=u*m*R-o*z,c[10]=T+(1-T)*L,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}const i=g;function l(e,h,r,c){const o=c??new n(16);let u=h[0],m=h[1],_=h[2];const M=Math.sqrt(u*u+m*m+_*_);u/=M,m/=M,_/=M;const A=u*u,T=m*m,L=_*_,z=Math.cos(r),R=Math.sin(r),B=1-z,H=A+(1-A)*z,U=u*m*B+_*R,F=u*_*B-m*R,Z=u*m*B-_*R,Q=T+(1-T)*z,rt=m*_*B+u*R,at=u*_*B+m*R,ct=m*_*B-u*R,ht=L+(1-L)*z,_t=e[0],gt=e[1],wt=e[2],mt=e[3],yt=e[4],Et=e[5],Mt=e[6],Dt=e[7],St=e[8],zt=e[9],Rt=e[10],Ct=e[11];return o[0]=H*_t+U*yt+F*St,o[1]=H*gt+U*Et+F*zt,o[2]=H*wt+U*Mt+F*Rt,o[3]=H*mt+U*Dt+F*Ct,o[4]=Z*_t+Q*yt+rt*St,o[5]=Z*gt+Q*Et+rt*zt,o[6]=Z*wt+Q*Mt+rt*Rt,o[7]=Z*mt+Q*Dt+rt*Ct,o[8]=at*_t+ct*yt+ht*St,o[9]=at*gt+ct*Et+ht*zt,o[10]=at*wt+ct*Mt+ht*Rt,o[11]=at*mt+ct*Dt+ht*Ct,e!==o&&(o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}const a=l;function p(e,h){const r=h??new n(16);return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function y(e,h,r){const c=r??new n(16),o=h[0],u=h[1],m=h[2];return c[0]=o*e[0*4+0],c[1]=o*e[0*4+1],c[2]=o*e[0*4+2],c[3]=o*e[0*4+3],c[4]=u*e[1*4+0],c[5]=u*e[1*4+1],c[6]=u*e[1*4+2],c[7]=u*e[1*4+3],c[8]=m*e[2*4+0],c[9]=m*e[2*4+1],c[10]=m*e[2*4+2],c[11]=m*e[2*4+3],e!==c&&(c[12]=e[12],c[13]=e[13],c[14]=e[14],c[15]=e[15]),c}function x(e,h){const r=h??new n(16);return r[0]=e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function v(e,h,r){const c=r??new n(16);return c[0]=h*e[0*4+0],c[1]=h*e[0*4+1],c[2]=h*e[0*4+2],c[3]=h*e[0*4+3],c[4]=h*e[1*4+0],c[5]=h*e[1*4+1],c[6]=h*e[1*4+2],c[7]=h*e[1*4+3],c[8]=h*e[2*4+0],c[9]=h*e[2*4+1],c[10]=h*e[2*4+2],c[11]=h*e[2*4+3],e!==c&&(c[12]=e[12],c[13]=e[13],c[14]=e[14],c[15]=e[15]),c}return{add:S,aim:bt,axisRotate:l,axisRotation:g,cameraAim:Gt,clone:C,copy:G,create:s,determinant:st,equals:tt,equalsApproximately:$,fromMat3:f,fromQuat:w,frustum:Ft,frustumReverseZ:pt,getAxis:Lt,getScaling:kt,getTranslation:Pt,identity:W,inverse:J,invert:ut,lookAt:nt,mul:lt,mulScalar:I,multiply:it,multiplyScalar:P,negate:b,ortho:vt,perspective:ft,perspectiveReverseZ:Ut,rotate:a,rotateX:Tt,rotateY:Nt,rotateZ:k,rotation:i,rotationX:Ht,rotationY:It,rotationZ:E,scale:y,scaling:p,set:d,setAxis:Ot,setTranslation:ot,translate:At,translation:Vt,transpose:V,uniformScale:v,uniformScaling:x}}const Ze=new Map;function Wn(n){let t=Ze.get(n);return t||(t=Yn(n),Ze.set(n,t)),t}function jn(n){const t=ye(n);function s(E,k,g,i){const l=new n(4);return E!==void 0&&(l[0]=E,k!==void 0&&(l[1]=k,g!==void 0&&(l[2]=g,i!==void 0&&(l[3]=i)))),l}const d=s;function f(E,k,g,i,l){const a=l??new n(4);return a[0]=E,a[1]=k,a[2]=g,a[3]=i,a}function w(E,k,g){const i=g??new n(4),l=k*.5,a=Math.sin(l);return i[0]=a*E[0],i[1]=a*E[1],i[2]=a*E[2],i[3]=Math.cos(l),i}function b(E,k){const g=k??t.create(3),i=Math.acos(E[3])*2,l=Math.sin(i*.5);return l>X?(g[0]=E[0]/l,g[1]=E[1]/l,g[2]=E[2]/l):(g[0]=1,g[1]=0,g[2]=0),{angle:i,axis:g}}function S(E,k){const g=ft(E,k);return Math.acos(2*g*g-1)}function P(E,k,g){const i=g??new n(4),l=E[0],a=E[1],p=E[2],y=E[3],x=k[0],v=k[1],e=k[2],h=k[3];return i[0]=l*h+y*x+a*e-p*v,i[1]=a*h+y*v+p*x-l*e,i[2]=p*h+y*e+l*v-a*x,i[3]=y*h-l*x-a*v-p*e,i}const I=P;function G(E,k,g){const i=g??new n(4),l=k*.5,a=E[0],p=E[1],y=E[2],x=E[3],v=Math.sin(l),e=Math.cos(l);return i[0]=a*e+x*v,i[1]=p*e+y*v,i[2]=y*e-p*v,i[3]=x*e-a*v,i}function C(E,k,g){const i=g??new n(4),l=k*.5,a=E[0],p=E[1],y=E[2],x=E[3],v=Math.sin(l),e=Math.cos(l);return i[0]=a*e-y*v,i[1]=p*e+x*v,i[2]=y*e+a*v,i[3]=x*e-p*v,i}function $(E,k,g){const i=g??new n(4),l=k*.5,a=E[0],p=E[1],y=E[2],x=E[3],v=Math.sin(l),e=Math.cos(l);return i[0]=a*e+p*v,i[1]=p*e-a*v,i[2]=y*e+x*v,i[3]=x*e-y*v,i}function tt(E,k,g,i){const l=i??new n(4),a=E[0],p=E[1],y=E[2],x=E[3];let v=k[0],e=k[1],h=k[2],r=k[3],c=a*v+p*e+y*h+x*r;c<0&&(c=-c,v=-v,e=-e,h=-h,r=-r);let o,u;if(1-c>X){const m=Math.acos(c),_=Math.sin(m);o=Math.sin((1-g)*m)/_,u=Math.sin(g*m)/_}else o=1-g,u=g;return l[0]=o*a+u*v,l[1]=o*p+u*e,l[2]=o*y+u*h,l[3]=o*x+u*r,l}function W(E,k){const g=k??new n(4),i=E[0],l=E[1],a=E[2],p=E[3],y=i*i+l*l+a*a+p*p,x=y?1/y:0;return g[0]=-i*x,g[1]=-l*x,g[2]=-a*x,g[3]=p*x,g}function V(E,k){const g=k??new n(4);return g[0]=-E[0],g[1]=-E[1],g[2]=-E[2],g[3]=E[3],g}function J(E,k){const g=k??new n(4),i=E[0]+E[5]+E[10];if(i>0){const l=Math.sqrt(i+1);g[3]=.5*l;const a=.5/l;g[0]=(E[6]-E[9])*a,g[1]=(E[8]-E[2])*a,g[2]=(E[1]-E[4])*a}else{let l=0;E[5]>E[0]&&(l=1),E[10]>E[l*4+l]&&(l=2);const a=(l+1)%3,p=(l+2)%3,y=Math.sqrt(E[l*4+l]-E[a*4+a]-E[p*4+p]+1);g[l]=.5*y;const x=.5/y;g[3]=(E[a*4+p]-E[p*4+a])*x,g[a]=(E[a*4+l]+E[l*4+a])*x,g[p]=(E[p*4+l]+E[l*4+p])*x}return g}function st(E,k,g,i,l){const a=l??new n(4),p=E*.5,y=k*.5,x=g*.5,v=Math.sin(p),e=Math.cos(p),h=Math.sin(y),r=Math.cos(y),c=Math.sin(x),o=Math.cos(x);switch(i){case"xyz":a[0]=v*r*o+e*h*c,a[1]=e*h*o-v*r*c,a[2]=e*r*c+v*h*o,a[3]=e*r*o-v*h*c;break;case"xzy":a[0]=v*r*o-e*h*c,a[1]=e*h*o-v*r*c,a[2]=e*r*c+v*h*o,a[3]=e*r*o+v*h*c;break;case"yxz":a[0]=v*r*o+e*h*c,a[1]=e*h*o-v*r*c,a[2]=e*r*c-v*h*o,a[3]=e*r*o+v*h*c;break;case"yzx":a[0]=v*r*o+e*h*c,a[1]=e*h*o+v*r*c,a[2]=e*r*c-v*h*o,a[3]=e*r*o-v*h*c;break;case"zxy":a[0]=v*r*o-e*h*c,a[1]=e*h*o+v*r*c,a[2]=e*r*c+v*h*o,a[3]=e*r*o-v*h*c;break;case"zyx":a[0]=v*r*o-e*h*c,a[1]=e*h*o+v*r*c,a[2]=e*r*c-v*h*o,a[3]=e*r*o+v*h*c;break;default:throw new Error(`Unknown rotation order: ${i}`)}return a}function ut(E,k){const g=k??new n(4);return g[0]=E[0],g[1]=E[1],g[2]=E[2],g[3]=E[3],g}const it=ut;function lt(E,k,g){const i=g??new n(4);return i[0]=E[0]+k[0],i[1]=E[1]+k[1],i[2]=E[2]+k[2],i[3]=E[3]+k[3],i}function ot(E,k,g){const i=g??new n(4);return i[0]=E[0]-k[0],i[1]=E[1]-k[1],i[2]=E[2]-k[2],i[3]=E[3]-k[3],i}const Pt=ot;function Lt(E,k,g){const i=g??new n(4);return i[0]=E[0]*k,i[1]=E[1]*k,i[2]=E[2]*k,i[3]=E[3]*k,i}const Ot=Lt;function kt(E,k,g){const i=g??new n(4);return i[0]=E[0]/k,i[1]=E[1]/k,i[2]=E[2]/k,i[3]=E[3]/k,i}function ft(E,k){return E[0]*k[0]+E[1]*k[1]+E[2]*k[2]+E[3]*k[3]}function Ut(E,k,g,i){const l=i??new n(4);return l[0]=E[0]+g*(k[0]-E[0]),l[1]=E[1]+g*(k[1]-E[1]),l[2]=E[2]+g*(k[2]-E[2]),l[3]=E[3]+g*(k[3]-E[3]),l}function vt(E){const k=E[0],g=E[1],i=E[2],l=E[3];return Math.sqrt(k*k+g*g+i*i+l*l)}const Ft=vt;function pt(E){const k=E[0],g=E[1],i=E[2],l=E[3];return k*k+g*g+i*i+l*l}const j=pt;function K(E,k){const g=k??new n(4),i=E[0],l=E[1],a=E[2],p=E[3],y=Math.sqrt(i*i+l*l+a*a+p*p);return y>1e-5?(g[0]=i/y,g[1]=l/y,g[2]=a/y,g[3]=p/y):(g[0]=0,g[1]=0,g[2]=0,g[3]=1),g}function Y(E,k){return Math.abs(E[0]-k[0])<X&&Math.abs(E[1]-k[1])<X&&Math.abs(E[2]-k[2])<X&&Math.abs(E[3]-k[3])<X}function bt(E,k){return E[0]===k[0]&&E[1]===k[1]&&E[2]===k[2]&&E[3]===k[3]}function Gt(E){const k=E??new n(4);return k[0]=0,k[1]=0,k[2]=0,k[3]=1,k}const nt=t.create(),Vt=t.create(),At=t.create();function Ht(E,k,g){const i=g??new n(4),l=t.dot(E,k);return l<-.999999?(t.cross(Vt,E,nt),t.len(nt)<1e-6&&t.cross(At,E,nt),t.normalize(nt,nt),w(nt,Math.PI,i),i):l>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(t.cross(E,k,nt),i[0]=nt[0],i[1]=nt[1],i[2]=nt[2],i[3]=1+l,K(i,i))}const Tt=new n(4),It=new n(4);function Nt(E,k,g,i,l,a){const p=a??new n(4);return tt(E,i,l,Tt),tt(k,g,l,It),tt(Tt,It,2*l*(1-l),p),p}return{create:s,fromValues:d,set:f,fromAxisAngle:w,toAxisAngle:b,angle:S,multiply:P,mul:I,rotateX:G,rotateY:C,rotateZ:$,slerp:tt,inverse:W,conjugate:V,fromMat:J,fromEuler:st,copy:ut,clone:it,add:lt,subtract:ot,sub:Pt,mulScalar:Lt,scale:Ot,divScalar:kt,dot:ft,lerp:Ut,length:vt,len:Ft,lengthSq:pt,lenSq:j,normalize:K,equalsApproximately:Y,equals:bt,identity:Gt,rotationTo:Ht,sqlerp:Nt}}const Je=new Map;function Kn(n){let t=Je.get(n);return t||(t=jn(n),Je.set(n,t)),t}function Qn(n){function t(g,i,l,a){const p=new n(4);return g!==void 0&&(p[0]=g,i!==void 0&&(p[1]=i,l!==void 0&&(p[2]=l,a!==void 0&&(p[3]=a)))),p}const s=t;function d(g,i,l,a,p){const y=p??new n(4);return y[0]=g,y[1]=i,y[2]=l,y[3]=a,y}function f(g,i){const l=i??new n(4);return l[0]=Math.ceil(g[0]),l[1]=Math.ceil(g[1]),l[2]=Math.ceil(g[2]),l[3]=Math.ceil(g[3]),l}function w(g,i){const l=i??new n(4);return l[0]=Math.floor(g[0]),l[1]=Math.floor(g[1]),l[2]=Math.floor(g[2]),l[3]=Math.floor(g[3]),l}function b(g,i){const l=i??new n(4);return l[0]=Math.round(g[0]),l[1]=Math.round(g[1]),l[2]=Math.round(g[2]),l[3]=Math.round(g[3]),l}function S(g,i=0,l=1,a){const p=a??new n(4);return p[0]=Math.min(l,Math.max(i,g[0])),p[1]=Math.min(l,Math.max(i,g[1])),p[2]=Math.min(l,Math.max(i,g[2])),p[3]=Math.min(l,Math.max(i,g[3])),p}function P(g,i,l){const a=l??new n(4);return a[0]=g[0]+i[0],a[1]=g[1]+i[1],a[2]=g[2]+i[2],a[3]=g[3]+i[3],a}function I(g,i,l,a){const p=a??new n(4);return p[0]=g[0]+i[0]*l,p[1]=g[1]+i[1]*l,p[2]=g[2]+i[2]*l,p[3]=g[3]+i[3]*l,p}function G(g,i,l){const a=l??new n(4);return a[0]=g[0]-i[0],a[1]=g[1]-i[1],a[2]=g[2]-i[2],a[3]=g[3]-i[3],a}const C=G;function $(g,i){return Math.abs(g[0]-i[0])<X&&Math.abs(g[1]-i[1])<X&&Math.abs(g[2]-i[2])<X&&Math.abs(g[3]-i[3])<X}function tt(g,i){return g[0]===i[0]&&g[1]===i[1]&&g[2]===i[2]&&g[3]===i[3]}function W(g,i,l,a){const p=a??new n(4);return p[0]=g[0]+l*(i[0]-g[0]),p[1]=g[1]+l*(i[1]-g[1]),p[2]=g[2]+l*(i[2]-g[2]),p[3]=g[3]+l*(i[3]-g[3]),p}function V(g,i,l,a){const p=a??new n(4);return p[0]=g[0]+l[0]*(i[0]-g[0]),p[1]=g[1]+l[1]*(i[1]-g[1]),p[2]=g[2]+l[2]*(i[2]-g[2]),p[3]=g[3]+l[3]*(i[3]-g[3]),p}function J(g,i,l){const a=l??new n(4);return a[0]=Math.max(g[0],i[0]),a[1]=Math.max(g[1],i[1]),a[2]=Math.max(g[2],i[2]),a[3]=Math.max(g[3],i[3]),a}function st(g,i,l){const a=l??new n(4);return a[0]=Math.min(g[0],i[0]),a[1]=Math.min(g[1],i[1]),a[2]=Math.min(g[2],i[2]),a[3]=Math.min(g[3],i[3]),a}function ut(g,i,l){const a=l??new n(4);return a[0]=g[0]*i,a[1]=g[1]*i,a[2]=g[2]*i,a[3]=g[3]*i,a}const it=ut;function lt(g,i,l){const a=l??new n(4);return a[0]=g[0]/i,a[1]=g[1]/i,a[2]=g[2]/i,a[3]=g[3]/i,a}function ot(g,i){const l=i??new n(4);return l[0]=1/g[0],l[1]=1/g[1],l[2]=1/g[2],l[3]=1/g[3],l}const Pt=ot;function Lt(g,i){return g[0]*i[0]+g[1]*i[1]+g[2]*i[2]+g[3]*i[3]}function Ot(g){const i=g[0],l=g[1],a=g[2],p=g[3];return Math.sqrt(i*i+l*l+a*a+p*p)}const kt=Ot;function ft(g){const i=g[0],l=g[1],a=g[2],p=g[3];return i*i+l*l+a*a+p*p}const Ut=ft;function vt(g,i){const l=g[0]-i[0],a=g[1]-i[1],p=g[2]-i[2],y=g[3]-i[3];return Math.sqrt(l*l+a*a+p*p+y*y)}const Ft=vt;function pt(g,i){const l=g[0]-i[0],a=g[1]-i[1],p=g[2]-i[2],y=g[3]-i[3];return l*l+a*a+p*p+y*y}const j=pt;function K(g,i){const l=i??new n(4),a=g[0],p=g[1],y=g[2],x=g[3],v=Math.sqrt(a*a+p*p+y*y+x*x);return v>1e-5?(l[0]=a/v,l[1]=p/v,l[2]=y/v,l[3]=x/v):(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function Y(g,i){const l=i??new n(4);return l[0]=-g[0],l[1]=-g[1],l[2]=-g[2],l[3]=-g[3],l}function bt(g,i){const l=i??new n(4);return l[0]=g[0],l[1]=g[1],l[2]=g[2],l[3]=g[3],l}const Gt=bt;function nt(g,i,l){const a=l??new n(4);return a[0]=g[0]*i[0],a[1]=g[1]*i[1],a[2]=g[2]*i[2],a[3]=g[3]*i[3],a}const Vt=nt;function At(g,i,l){const a=l??new n(4);return a[0]=g[0]/i[0],a[1]=g[1]/i[1],a[2]=g[2]/i[2],a[3]=g[3]/i[3],a}const Ht=At;function Tt(g){const i=g??new n(4);return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i}function It(g,i,l){const a=l??new n(4),p=g[0],y=g[1],x=g[2],v=g[3];return a[0]=i[0]*p+i[4]*y+i[8]*x+i[12]*v,a[1]=i[1]*p+i[5]*y+i[9]*x+i[13]*v,a[2]=i[2]*p+i[6]*y+i[10]*x+i[14]*v,a[3]=i[3]*p+i[7]*y+i[11]*x+i[15]*v,a}function Nt(g,i,l){const a=l??new n(4);return K(g,a),ut(a,i,a)}function E(g,i,l){const a=l??new n(4);return Ot(g)>i?Nt(g,i,a):bt(g,a)}function k(g,i,l){const a=l??new n(4);return W(g,i,.5,a)}return{create:t,fromValues:s,set:d,ceil:f,floor:w,round:b,clamp:S,add:P,addScaled:I,subtract:G,sub:C,equalsApproximately:$,equals:tt,lerp:W,lerpV:V,max:J,min:st,mulScalar:ut,scale:it,divScalar:lt,inverse:ot,invert:Pt,dot:Lt,length:Ot,len:kt,lengthSq:ft,lenSq:Ut,distance:vt,dist:Ft,distanceSq:pt,distSq:j,normalize:K,negate:Y,copy:bt,clone:Gt,multiply:nt,mul:Vt,divide:At,div:Ht,zero:Tt,transformMat4:It,setLength:Nt,truncate:E,midpoint:k}}const tn=new Map;function Zn(n){let t=tn.get(n);return t||(t=Qn(n),tn.set(n,t)),t}function ke(n,t,s,d,f,w){return{mat3:Xn(n),mat4:Wn(t),quat:Kn(s),vec2:dn(d),vec3:ye(f),vec4:Zn(w)}}const{mat4:Bt,vec3:q}=ke(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);ke(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);ke(Vn,Array,Array,Array,Array,Array);function Jn(n,t){const s={forward:!1,backward:!1,left:!1,right:!1,up:!1,down:!1},d={x:0,y:0,zoom:0};let f=!1;const w=(b,S)=>{switch(b.code){case"KeyW":s.forward=S,b.preventDefault(),b.stopPropagation();break;case"KeyS":s.backward=S,b.preventDefault(),b.stopPropagation();break;case"KeyA":s.left=S,b.preventDefault(),b.stopPropagation();break;case"KeyD":s.right=S,b.preventDefault(),b.stopPropagation();break;case"Space":s.up=S,b.preventDefault(),b.stopPropagation();break;case"ShiftLeft":case"ControlLeft":case"KeyC":s.down=S,b.preventDefault(),b.stopPropagation();break}};return n.addEventListener("keydown",b=>w(b,!0)),n.addEventListener("keyup",b=>w(b,!1)),t.style.touchAction="pinch-zoom",t.addEventListener("pointerdown",()=>{f=!0}),t.addEventListener("pointerup",()=>{f=!1}),t.addEventListener("pointermove",b=>{f=b.pointerType==="mouse"?(b.buttons&1)!==0:!0,f&&(d.x+=b.movementX,d.y+=b.movementY)}),t.addEventListener("wheel",b=>{f=(b.buttons&1)!==0,f&&(d.zoom+=Math.sign(b.deltaY),b.preventDefault(),b.stopPropagation())},{passive:!1}),()=>{const b={digital:s,analog:{x:d.x,y:d.y,zoom:d.zoom,touching:f}};return d.x=0,d.y=0,d.zoom=0,b}}class fn{constructor(){N(this,"$matrix",new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]));N(this,"$view",Bt.create());N(this,"$right",new Float32Array(this.$matrix.buffer,4*0,4));N(this,"$up",new Float32Array(this.$matrix.buffer,4*4,4));N(this,"$back",new Float32Array(this.$matrix.buffer,4*8,4));N(this,"$position",new Float32Array(this.$matrix.buffer,4*12,4))}get matrix(){return this.$matrix}set matrix(t){Bt.copy(t,this.$matrix)}get view(){return this.$view}set view(t){Bt.copy(t,this.$view)}get right(){return this.$right}set right(t){q.copy(t,this.$right)}get up(){return this.$up}set up(t){q.copy(t,this.$up)}get back(){return this.$back}set back(t){q.copy(t,this.$back)}get position(){return this.$position}set position(t){q.copy(t,this.$position)}}function ti(n,t,s){return Math.min(Math.max(n,t),s)}function ei(n,t){return n-Math.floor(Math.abs(n)/t)*t*Math.sign(n)}function ni(n,t,s){return q.transformMat4Upper3x3(n,Bt.rotation(t,s))}function ii(n,t,s){return q.addScaled(n,q.sub(t,n),s)}class si extends fn{constructor(s){super();N(this,"pitch",0);N(this,"yaw",0);N(this,"$velocity",q.create());N(this,"movementSpeed",10);N(this,"rotationSpeed",1);N(this,"frictionCoefficient",.99);if(s&&(s.position||s.target)){const d=s.position??q.create(0,0,-5),f=s.target??q.create(0,0,0),w=q.normalize(q.sub(d,f));this.recalculateAngles(w),this.position=d}}get velocity(){return this.$velocity}set velocity(s){q.copy(s,this.$velocity)}get matrix(){return super.matrix}set matrix(s){super.matrix=s,this.recalculateAngles(this.back)}update(s,d){const f=(C,$)=>(C?1:0)-($?1:0);this.yaw-=d.analog.x*s*this.rotationSpeed,this.pitch-=d.analog.y*s*this.rotationSpeed,this.yaw=ei(this.yaw,Math.PI*2),this.pitch=ti(this.pitch,-Math.PI/2,Math.PI/2);const w=q.copy(this.position);super.matrix=Bt.rotateX(Bt.rotationY(this.yaw),this.pitch);const{digital:b}=d,S=f(b.right,b.left),P=f(b.up,b.down),I=q.create(),G=f(b.backward,b.forward);return q.addScaled(I,this.right,S,I),q.addScaled(I,this.up,P,I),q.addScaled(I,this.back,G,I),q.normalize(I,I),q.mulScalar(I,this.movementSpeed,I),this.velocity=ii(I,this.velocity,(1-this.frictionCoefficient)**s),this.position=q.addScaled(w,this.velocity,s),this.view=Bt.invert(this.matrix),this.view}recalculateAngles(s){this.yaw=Math.atan2(s[0],s[2]),this.pitch=-Math.asin(s[1])}}class oi extends fn{constructor(s){super();N(this,"distance",0);N(this,"angularVelocity",0);N(this,"$axis",q.create());N(this,"rotationSpeed",1);N(this,"zoomSpeed",.1);N(this,"frictionCoefficient",.999);s&&s.position&&(this.position=s.position,this.distance=q.len(this.position),this.back=q.normalize(this.position),this.recalcuateRight(),this.recalcuateUp())}get axis(){return this.$axis}set axis(s){q.copy(s,this.$axis)}get matrix(){return super.matrix}set matrix(s){super.matrix=s,this.distance=q.len(this.position)}update(s,d){d.analog.touching?this.angularVelocity=0:this.angularVelocity*=(1-this.frictionCoefficient)**s;const w=q.create();q.addScaled(w,this.right,d.analog.x,w),q.addScaled(w,this.up,-d.analog.y,w);const b=q.cross(w,this.back),S=q.len(b);S>1e-7&&(this.axis=q.scale(b,1/S),this.angularVelocity=S*this.rotationSpeed);const P=this.angularVelocity*s;return P>1e-7&&(this.back=q.normalize(ni(this.back,this.axis,P)),this.recalcuateRight(),this.recalcuateUp()),d.analog.zoom!==0&&(this.distance*=1+d.analog.zoom*this.zoomSpeed),this.position=q.scale(this.back,this.distance),this.view=Bt.invert(this.matrix),this.view}recalcuateRight(){this.right=q.normalize(q.cross(this.up,this.back))}recalcuateUp(){this.up=q.normalize(q.cross(this.back,this.right))}}class ri{constructor(t,s){N(this,"inputHandler");N(this,"initialCameraPosition",q.create(0,0,50));N(this,"instances",{wasd:new si({position:this.initialCameraPosition}),arcball:new oi({position:this.initialCameraPosition})});N(this,"uniformBuffer");N(this,"aspect");N(this,"projectionMatrix");N(this,"modelViewProjectionMatrix",Bt.create());N(this,"lastFrameMS",Date.now());N(this,"type","arcball");this.device=t,this.canvas=s,this.inputHandler=Jn(window,s),this.uniformBuffer=t.createBuffer({size:4*36,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.aspect=s.width/s.height,this.projectionMatrix=Bt.perspective(2*Math.PI/5,this.aspect,.01,1e4)}setRenderDistance(t=1,s=100){this.projectionMatrix=Bt.perspective(2*Math.PI/5,this.aspect,t,s)}get cameraInstance(){return this.instances[this.type]}getCameraUniformData(t){const s=this.cameraInstance.update(t,this.inputHandler());return Bt.multiply(this.projectionMatrix,s,this.modelViewProjectionMatrix),new Float32Array([...this.modelViewProjectionMatrix,...s,...this.cameraInstance.position])}setType(t){this.instances[t].matrix=this.instances[this.type].matrix,this.type=t}getUniformBuffer(){return this.uniformBuffer}frame(){const t=Date.now(),s=(t-this.lastFrameMS)/1e3;this.lastFrameMS=t;const d=this.getCameraUniformData(s);this.device.queue.writeBuffer(this.uniformBuffer,0,d.buffer,d.byteOffset,d.byteLength)}}var hn=(n=>(n.Cube="cube",n.Gaussian="gaussian",n.GaussianDisc="gaussian-disc",n.Sphere="sphere",n))(hn||{});function oe(n=0,t=1){const s=1-Math.random(),d=1-Math.random(),f=Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*d);return n+t*f}function ge(n=0,t=1){return n+Math.random()*t-.5*t}function ai(){const n=Math.random()*2*Math.PI,t=Math.acos(2*Math.random()-1),s=Math.cbrt(Math.random()),d=Math.sin(t)*Math.cos(n)*s,f=Math.sin(t)*Math.sin(n)*s,w=Math.cos(t)*s;return{x:d,y:f,z:w}}function en(n,t,s,d=0,f=1){const w=t*s,b=new Float32Array(w*4);for(let P=0;P<w;P+=1)b[P*4+0]=ge(d,f),b[P*4+1]=ge(d,f),b[P*4+2]=ge(d,f),b[P*4+3]=1;const S=n.createTexture({size:{width:t,height:s},format:"rgba32float",usage:GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT});return n.queue.writeTexture({texture:S},b.buffer,{bytesPerRow:t*16,rowsPerImage:s},{width:t,height:s,depthOrArrayLayers:1}),S}function ci(n,t,s,d=0,f=1){const w=t*s,b=new Float32Array(w*4);for(let P=0;P<w;P+=1)b[P*4+0]=oe(d,f),b[P*4+1]=ge(d,f*.5),b[P*4+2]=oe(d,f),b[P*4+3]=1;const S=n.createTexture({size:{width:t,height:s},format:"rgba32float",usage:GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT});return n.queue.writeTexture({texture:S},b.buffer,{bytesPerRow:t*16,rowsPerImage:s},{width:t,height:s,depthOrArrayLayers:1}),S}function ui(n,t,s,d=0,f=1){const w=t*s,b=new Float32Array(w*4);for(let P=0;P<w;P+=1)b[P*4+0]=oe(d,f),b[P*4+1]=oe(d,f),b[P*4+2]=oe(d,f),b[P*4+3]=1;const S=n.createTexture({size:{width:t,height:s},format:"rgba32float",usage:GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT});return n.queue.writeTexture({texture:S},b.buffer,{bytesPerRow:t*16,rowsPerImage:s},{width:t,height:s,depthOrArrayLayers:1}),S}function li(n,t,s,d=0,f=1){const w=t*s,b=new Float32Array(w*4);for(let P=0;P<w;P+=1){const{x:I,y:G,z:C}=ai();b[P*4+0]=d+I*f,b[P*4+1]=d+G*f,b[P*4+2]=d+C*f,b[P*4+3]=1}const S=n.createTexture({size:{width:t,height:s},format:"rgba32float",usage:GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT});return n.queue.writeTexture({texture:S},b.buffer,{bytesPerRow:t*16,rowsPerImage:s},{width:t,height:s,depthOrArrayLayers:1}),S}const nn={uniform:en,cube:en,gaussian:ui,"gaussian-disc":ci,sphere:li};function pn(n){return n.reduce((t,s)=>t.then(d=>s().then(Array.prototype.concat.bind(d))),Promise.resolve([]))}function di(n){const t=n>>16&255,s=n>>8&255,d=n&255;return q.create(t/255,s/255,d/255)}class ze{constructor({context:t,commandEncoder:s,canvas:d,camera:f}){N(this,"context");N(this,"commandEncoder");N(this,"passEncoder");N(this,"canvas");N(this,"ctx");N(this,"format");N(this,"camera");N(this,"kernels",[]);this.context=t,this.commandEncoder=s,this.canvas=d,this.camera=f,this.format=navigator.gpu.getPreferredCanvasFormat(),this.ctx=d.getContext("webgpu"),this.ctx.configure({device:t.device,format:this.format});const w=this.context.device.createTexture({size:[d.width,d.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT});this.passEncoder=this.commandEncoder.beginRenderPass({colorAttachments:[{view:this.ctx.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store",clearValue:[0,0,0,1]}],depthStencilAttachment:{view:w.createView(),depthLoadOp:"clear",depthStoreOp:"store",depthClearValue:1}})}async addKernel(t){await t.prepare(),this.kernels.push(t)}async submit(){await pn(this.kernels.map(t=>()=>t.run())),this.passEncoder.end(),this.context.device.queue.submit([this.commandEncoder.finish()]),await this.context.device.queue.onSubmittedWorkDone()}static create(t){return new ze({...t,commandEncoder:t.context.device.createCommandEncoder()})}}const fi=`struct Particle {
  @align(16) position: vec3<f32>, // 12 bytes + 4 bytes (padding) - Particle position
  @align(16) velocity: vec3<f32>, // 12 bytes + 4 bytes (padding) - Particle velocity
  @align(16) color: vec4<f32>,    // 16 bytes                     - Particle color
  mass: f32,                      //  4 bytes                     - Particle mass
  size: f32,                      //  4 bytes                     - Particle size
  alive: u32,                     //  4 bytes                     - Marked for removal
  padding: f32,                   //  4 bytes                     - Padding
}

struct CameraUniform {
  projectionMatrix : mat4x4<f32>,
  viewMatrix: mat4x4<f32>,
  cameraPosition: vec3<f32>,
}

struct VertexOutput {
  @builtin(position) position: vec4<f32>,
  @location(0) localPos: vec2<f32>,
  @location(1) color: vec4<f32>,
  @location(2) localOffset: vec3<f32>,
  @location(3) @interpolate(flat) alive: u32,
}

override SIZE_FACTOR: f32 = 0.05;

@group(0) @binding(0) var particleTexture: texture_storage_2d<rgba32float, read>;
@group(0) @binding(1) var<uniform> camera: CameraUniform;

fn getParticle(index: u32) -> Particle {
  let dimX = textureDimensions(particleTexture).r;

  let x = i32((index * 4u) % dimX);
  let y = i32(((index * 4u) / dimX));

  let data1 = textureLoad(particleTexture, vec2<i32>(x, y));
  let data2 = textureLoad(particleTexture, vec2<i32>(x + 1, y));
  let data3 = textureLoad(particleTexture, vec2<i32>(x + 2, y));
  let data4 = textureLoad(particleTexture, vec2<i32>(x + 3, y));

  return Particle(
    data1.xyz,
    data2.xyz,
    data3,
    data4.x,
    data4.y * SIZE_FACTOR,
    u32(data4.z),
    data4.w,
  );
}

@vertex
fn vs_billboard(
  @builtin(vertex_index) vertexIndex: u32,
  @builtin(instance_index) instanceIndex: u32
) -> VertexOutput {
  var quad = array<vec2<f32>, 6>(
    vec2<f32>(-1.0, -1.0),
    vec2<f32>(1.0, -1.0),
    vec2<f32>(-1.0, 1.0),
    vec2<f32>(-1.0, 1.0),
    vec2<f32>(1.0, -1.0),
    vec2<f32>(1.0, 1.0),
  );

  let p = getParticle(instanceIndex);

  let right = vec3<f32>(camera.viewMatrix[0].x, camera.viewMatrix[1].x, camera.viewMatrix[2].x);
  let up = vec3<f32>(camera.viewMatrix[0].y, camera.viewMatrix[1].y, camera.viewMatrix[2].y);

  let offset = (quad[vertexIndex].x * right + quad[vertexIndex].y * up) * p.size;
  let worldPosition = p.position + offset;

  var out: VertexOutput;
  out.position = camera.projectionMatrix * vec4<f32>(worldPosition, 1.0);
  out.localPos = quad[vertexIndex];
  out.color = p.color;
  out.localOffset = p.position.xyz;
  out.alive = p.alive;

  return out;
}

@fragment
fn fs_billboard(in: VertexOutput) -> @location(0) vec4<f32> {
  let dist = length(in.localPos);
  if (dist > 1.0) { discard; }

  let alpha = smoothstep(1.0, 0.9, dist);
  return vec4<f32>(in.color.rgb, in.color.a * alpha);
}

`;class _n{constructor(t){N(this,"pipeline");N(this,"bindings",[]);N(this,"bindGroup");this.context=t}setBinding(t,s){const d=this.bindings.findIndex(f=>f.binding===t);return d!==-1?this.bindings[d]={binding:t,resource:s}:this.bindings.push({binding:t,resource:s}),this}setBindGroup(t=[]){if(!this.pipeline)throw new Error("Pipeline not initialized!");t.forEach(({binding:s,resource:d})=>{this.setBinding(s,d)}),this.bindGroup=this.context.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:this.bindings})}}class hi extends _n{constructor({renderPass:s,pipelineDescriptor:d}){super(s.context);N(this,"renderPass");this.pipeline=this.context.device.createRenderPipeline(d),this.renderPass=s}async run(){if(!this.pipeline)throw new Error("Pipeline not initialized!");if(!this.bindGroup)throw new Error("BindGroup not initialized!");this.renderPass.passEncoder.setPipeline(this.pipeline),this.renderPass.passEncoder.setBindGroup(0,this.bindGroup)}}class pi extends hi{constructor(t){const s=t.context.device.createShaderModule({code:fi});super({renderPass:t,pipelineDescriptor:{layout:"auto",vertex:{module:s,entryPoint:"vs_billboard",buffers:[{arrayStride:2*4,attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]}]},fragment:{module:s,entryPoint:"fs_billboard",targets:[{format:"bgra8unorm"}]},primitive:{topology:"triangle-list",cullMode:"none"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}})}async prepare(){const t=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.context.buffers.quadBuffer=this.context.device.createBuffer({size:t.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),this.context.device.queue.writeBuffer(this.context.buffers.quadBuffer,0,t),this.setBinding(0,this.context.textures.particleTexture.createView()).setBinding(1,{buffer:this.renderPass.camera.getUniformBuffer()}).setBindGroup()}async run(){super.run(),this.renderPass.passEncoder.setVertexBuffer(0,this.context.buffers.quadBuffer),this.renderPass.passEncoder.draw(6,this.context.particleCount)}}class _i{constructor({device:t,particleCount:s,distributionType:d,workgroupSizeX:f=256,workgroupSizeY:w=1,workgroupSizeZ:b=1,bitsPerPass:S=8,numBits:P=32,initParticlesDone:I=!1,initVelocity:G=!0,velocityFactor:C=.05}){N(this,"device");N(this,"particleCount");N(this,"distributionType");N(this,"workgroupSize",[1,1,1]);N(this,"bitsPerPass",8);N(this,"numBits",32);N(this,"initParticlesDone",!1);N(this,"initVelocity",!0);N(this,"velocityFactor",.05);N(this,"gravity",66743e-9);N(this,"debug",!1);N(this,"textures",{});N(this,"buffers",{});this.device=t,this.particleCount=s,this.distributionType=d,this.workgroupSize=[f,w,b],this.bitsPerPass=S,this.numBits=P,this.initParticlesDone=I,this.initVelocity=G,this.velocityFactor=C}get numBuckets(){return 2**this.bitsPerPass}}class Re{constructor(t,s){N(this,"kernels",[]);N(this,"passEncoder");this.context=t,this.commandEncoder=s,this.passEncoder=this.commandEncoder.beginComputePass()}async addKernel(t){await t.prepare(),this.kernels.push(t)}async submit(){await pn(this.kernels.map(t=>()=>t.run({pass:this}))),this.passEncoder.end(),this.context.device.queue.submit([this.commandEncoder.finish()]),await this.context.device.queue.onSubmittedWorkDone()}static create(t){const s=t.device.createCommandEncoder();return new Re(t,s)}}const gi=`struct Element {
  @align(16) color: vec4<f32>,
  mass: f32,
  rarity: f32,
  padding: vec2<f32>,
}

override PARTICLE_COUNT: u32;
override INIT_VELOCITY: u32 = 1u;
override VELOCITY_FACTOR: f32 = 0.05;

@group(0) @binding(0) var particleTexture: texture_storage_2d<rgba32float, write>;
@group(0) @binding(1) var<storage, read> elementsData: array<Element>;
@group(0) @binding(2) var gaussianNoiseTexture: texture_storage_2d<rgba32float, read>;
@group(0) @binding(3) var uniformNoiseTexture: texture_storage_2d<rgba32float, read>;

fn chooseElement(coord: vec2<i32>) -> Element {
  let noise = textureLoad(uniformNoiseTexture, coord);
  let rand = fract(noise.x + noise.y * 0.5 + noise.z * 0.25);  // Gnre un meilleur ala

  var sum = 0.0;
  for (var i = 0u; i < arrayLength(&elementsData); i = i + 1u) {
    sum = sum + elementsData[i].rarity;
    if (rand < sum) {
      return elementsData[i];
    }
  }
  return elementsData[arrayLength(&elementsData) - 1u]; // Dernier lment si rien n'est choisi
}

@compute @workgroup_size(256)
fn cs_init_particles(@builtin(global_invocation_id) id: vec3<u32>) {
  let index = id.x;
  if (index >= PARTICLE_COUNT) { return; }

  let dimNoiseX = textureDimensions(gaussianNoiseTexture).r;
  let pxNoise = i32(index % dimNoiseX);
  let pyNoise = i32(index / dimNoiseX);

  let element = chooseElement(vec2<i32>(pxNoise, pyNoise));
  let position = textureLoad(gaussianNoiseTexture, vec2<i32>(pxNoise, pyNoise)).rgb;

  var velocity = vec3<f32>(0.0);
  if (INIT_VELOCITY == 1u) {
    velocity = (position.xyz * 2.0 - vec3<f32>(1.0)) * VELOCITY_FACTOR;
  }

  let dimX = textureDimensions(particleTexture).r;
  let px = i32((index * 4u) % dimX);
  let py = i32((index * 4u) / dimX);

  textureStore(particleTexture, vec2<i32>(px, py), vec4<f32>(position, 0.0));
  textureStore(particleTexture, vec2<i32>(px + 1, py), vec4<f32>(velocity, 0.0));
  textureStore(particleTexture, vec2<i32>(px + 2, py), element.color);
  textureStore(particleTexture, vec2<i32>(px + 3, py), vec4<f32>(element.mass, pow(element.mass, 1.0 / 3.0), 1.0, 0.0));
}
`;function wi(n){return[...di(n.color),1,n.mass,n.probabilityWeight,0,0]}const mi=[{name:"Hydrogne",symbol:"H",mass:1.008,color:16777215,probabilityWeight:.91},{name:"Hlium",symbol:"He",mass:4.0026,color:15790320,probabilityWeight:.08},{name:"Oxygne",symbol:"O",mass:15.999,color:16715535,probabilityWeight:.005},{name:"Carbone",symbol:"C",mass:12.011,color:8421504,probabilityWeight:.002},{name:"Azote",symbol:"N",mass:14.007,color:2062260,probabilityWeight:.001},{name:"Non",symbol:"Ne",mass:20.18,color:16736e3,probabilityWeight:5e-4},{name:"Magnsium",symbol:"Mg",mass:24.305,color:65280,probabilityWeight:4e-4},{name:"Silicium",symbol:"Si",mass:28.085,color:10526880,probabilityWeight:3e-4},{name:"Soufre",symbol:"S",mass:32.06,color:16776960,probabilityWeight:2e-4},{name:"Fer",symbol:"Fe",mass:55.845,color:11674146,probabilityWeight:1e-4}];class gn extends _n{constructor(){super(...arguments);N(this,"dispatchSize",[1,1,1])}setDispatchSize(s,d=1,f=1){this.dispatchSize=[s,d,f]}initPipeline(s,d,f){return this.pipeline?this:(this.pipeline=this.context.device.createComputePipeline({layout:"auto",compute:{module:this.context.device.createShaderModule({code:s}),entryPoint:d,constants:f}}),this)}async run(s){if(!this.pipeline)throw new Error("Pipeline not initialized!");if(!this.bindGroup)throw new Error("BindGroup not initialized!");s.pass.passEncoder.setPipeline(this.pipeline),s.pass.passEncoder.setBindGroup(0,this.bindGroup),s.pass.passEncoder.dispatchWorkgroups(...this.dispatchSize)}}const yi=16,Ae=Math.ceil(yi/4);function xi(n){const t=Math.min(8192,n*Ae),s=Math.ceil(n*Ae/t);return{width:t,height:s}}class vi extends gn{constructor(t){super(t),this.setDispatchSize(Math.ceil(t.particleCount/t.workgroupSize[0]))}async prepare(){const{width:t,height:s}=xi(this.context.particleCount);this.context.textures.particleTexture=this.context.device.createTexture({size:{width:t,height:s},format:"rgba32float",usage:GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT}),this.context.textures.sortedParticleTexture=this.context.device.createTexture({size:{width:t,height:s},format:"rgba32float",usage:GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT});const d=new Float32Array(mi.reduce((b,S)=>[...b,...wi(S)],[]));this.context.buffers.elementsData=this.context.device.createBuffer({size:d.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.context.device.queue.writeBuffer(this.context.buffers.elementsData,0,d);const{width:f,height:w}={width:t/Ae,height:s};this.context.textures.gaussianNoiseTexture=nn[this.context.distributionType](this.context.device,f,w),this.context.textures.uniformNoiseTexture=nn.uniform(this.context.device,f,w),this.initPipeline(gi,"cs_init_particles",{PARTICLE_COUNT:this.context.particleCount,INIT_VELOCITY:+this.context.initVelocity,VELOCITY_FACTOR:this.context.velocityFactor}).setBinding(0,this.context.textures.particleTexture.createView()).setBinding(1,{buffer:this.context.buffers.elementsData}).setBinding(2,this.context.textures.gaussianNoiseTexture.createView()).setBinding(3,this.context.textures.uniformNoiseTexture.createView()).setBindGroup()}}const bi=`struct Particle {
  @align(16) position: vec3<f32>, // 12 bytes + 4 bytes (padding) - Particle position
  @align(16) velocity: vec3<f32>, // 12 bytes + 4 bytes (padding) - Particle velocity
  @align(16) color: vec4<f32>,    // 16 bytes                     - Particle color
  mass: f32,                      //  4 bytes                     - Particle mass
  size: f32,                      //  4 bytes                     - Particle size
  alive: u32,                     //  4 bytes                     - Marked for removal
  padding: f32,                   //  4 bytes                     - Padding
}

override WORKGROUP_SIZE: u32;
override PARTICLE_COUNT: u32;
override G: f32;

@group(0) @binding(0) var particleTextureRead: texture_storage_2d<rgba32float, read>;
@group(0) @binding(1) var particleTextureWrite: texture_storage_2d<rgba32float, write>;

const EPSILON: f32 = 1e-5;
const LIGHT_SPEED: f32 = 299792458.0;

fn getParticle(index: u32) -> Particle {
  let dimX = textureDimensions(particleTextureRead).r;
  let x = i32((index * 4u) % dimX);
  let y = i32((index * 4u) / dimX);

  let data1 = textureLoad(particleTextureRead, vec2<i32>(x, y));
  let data2 = textureLoad(particleTextureRead, vec2<i32>(x + 1, y));
  let data3 = textureLoad(particleTextureRead, vec2<i32>(x + 2, y));
  let data4 = textureLoad(particleTextureRead, vec2<i32>(x + 3, y));

  return Particle(
    data1.xyz,
    data2.xyz,
    data3,
    data4.x,
    data4.y,
    u32(data4.z),
    data4.w,
  );
}

fn setParticle(index: u32, particle: Particle) {
  let dimX = textureDimensions(particleTextureWrite).r;
  let x = i32((index * 4u) % dimX);
  let y = i32((index * 4u) / dimX);

  textureStore(particleTextureWrite, vec2<i32>(x, y), vec4<f32>(particle.position, 0.0));
  textureStore(particleTextureWrite, vec2<i32>(x + 1, y), vec4<f32>(particle.velocity, 0.0));
  textureStore(particleTextureWrite, vec2<i32>(x + 2, y), particle.color);
  textureStore(particleTextureWrite, vec2<i32>(x + 3, y), vec4<f32>(particle.mass, particle.size, f32(particle.alive), particle.padding));
}

fn computeGravitationelForce(p1: Particle, p2: Particle) -> vec3<f32> {
  let direction = p2.position - p1.position;
  let distance = max(length(direction), 1.0);

  let forceMagnitude = (G * p1.mass * p2.mass) / (distance * distance);

  if (distance <= EPSILON) {
    return vec3<f32>(0.0, 0.0, 0.0);
  }

  return normalize(direction) * forceMagnitude;
}

@compute @workgroup_size(WORKGROUP_SIZE)
fn cs_main(
  @builtin(global_invocation_id) global_id: vec3<u32>,
  @builtin(workgroup_id) workgroup_id: vec3<u32>
) {
  let i = global_id.x;
  if (i >= PARTICLE_COUNT) { return; }

  var particle_i = getParticle(i);
  if (particle_i.alive == 0u) { return; }

  var totalForce = vec3<f32>(0.0, 0.0, 0.0);

  for (var j: u32 = workgroup_id.x; j < workgroup_id.x + WORKGROUP_SIZE; j++) {
    if (i == j || j >= PARTICLE_COUNT) { continue; }

    let particle_j = getParticle(j);
    if (particle_j.alive == 0u) { continue; }

    let force = computeGravitationelForce(particle_i, particle_j);
    totalForce += force;
  }

  let acceleration = totalForce / particle_i.mass;

  particle_i.velocity = clamp(particle_i.velocity + acceleration, vec3<f32>(-LIGHT_SPEED), vec3<f32>(LIGHT_SPEED));
  particle_i.position += particle_i.velocity;

  setParticle(i, particle_i);
}
`;class Ei extends gn{constructor(t){super(t),this.setDispatchSize(Math.ceil(t.particleCount/t.workgroupSize[0]))}async prepare(){this.initPipeline(bi,"cs_main",{WORKGROUP_SIZE:this.context.workgroupSize[0],PARTICLE_COUNT:this.context.particleCount,G:this.context.gravity}).setBinding(0,this.context.textures.particleTexture.createView()).setBinding(1,this.context.textures.sortedParticleTexture.createView()).setBindGroup()}}const Mi=async n=>{const t=Re.create(n);n.initParticlesDone||(await t.addKernel(new vi(n)),n.initParticlesDone=!0),await t.addKernel(new Ei(n)),await t.submit(),[n.textures.particleTexture,n.textures.sortedParticleTexture]=[n.textures.sortedParticleTexture,n.textures.particleTexture]};async function Di(){const n=document.getElementById("warning");if(!navigator.gpu){console.error("WebGPU n'est pas support par votre navigateur !"),n==null||n.classList.remove("hide");return}const t=await navigator.gpu.requestAdapter();if(!t){console.error("WebGPU Adapter non disponible !"),n==null||n.classList.remove("hide");return}const s=await t.requestDevice({requiredLimits:{maxTextureDimension2D:8192}}),d=new Fn({width:340}),f={camera:"arcball",particleCount:1e4,distributionType:"gaussian",initVelocity:!0,velocityFactor:.05,gravity:-5},w=document.createElement("canvas");document.getElementById("app").appendChild(w),w.width=window.innerWidth,w.height=window.innerHeight;const b=new ri(s,w),S=new _i({device:s,particleCount:f.particleCount,distributionType:f.distributionType,workgroupSizeX:256,bitsPerPass:8,numBits:32,initParticlesDone:!1});d.add(f,"camera",["arcball","wasd"]).name("Camera type").onChange(()=>{b.setType(f.camera)}),d.add(f,"particleCount",100,1e7,100).name("Particles count").onChange(C=>{S.particleCount=C}),d.add(f,"distributionType",Object.values(hn)).name("Distribution type").onChange(C=>{S.distributionType=C}),d.add(f,"initVelocity").name("Init velocity?").onChange(C=>{S.initVelocity=C}),d.add(f,"velocityFactor",.01,.1,.01).name("Velocity multiplier").onChange(C=>{S.velocityFactor=C}),d.add(f,"gravity",-11,-1,-1).name("Gravity strength").onChange(C=>{S.gravity=6.6743*10**C});const I=d.add({restart(){S.initParticlesDone=!1}},"restart").name("Restart simulation").domElement.previousSibling.style;I.textAlign="center",I.fontWeight="bold";async function G(){b.frame(),await Mi(S);const C=ze.create({context:S,canvas:w,camera:b});await C.addKernel(new pi(C)),await C.submit(),requestAnimationFrame(G)}G()}window.addEventListener("DOMContentLoaded",async()=>{await Di()});
